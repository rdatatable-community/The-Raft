<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Toby Dylan Hocking">
<meta name="dcterms.date" content="2024-10-17">

<title>Comparing data.table reshape to duckdb and polars – Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-listing/list.min.js"></script>
<script src="../../site_libs/quarto-listing/quarto-listing.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-bab6d4080e933acd2ba5c5a05bee5553.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>

  window.document.addEventListener("DOMContentLoaded", function (_event) {
    const listingTargetEl = window.document.querySelector('#listing-listing .list');
    if (!listingTargetEl) {
      // No listing discovered, do not attach.
      return; 
    }

    const options = {
      valueNames: ['listing-date','listing-title','listing-author','listing-subtitle','listing-image','listing-description','listing-categories',{ data: ['index'] },{ data: ['categories'] },{ data: ['listing-date-sort'] },{ data: ['listing-file-modified-sort'] }],
      page: 25,
    pagination: { item: "<li class='page-item'><a class='page page-link' href='#'></a></li>" },
      searchColumns: ["listing-date","listing-title","listing-author","listing-subtitle","listing-image","listing-description","listing-categories"],
    };

    window['quarto-listings'] = window['quarto-listings'] || {};
    window['quarto-listings']['listing-listing'] = new List('listing-listing', options);

    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  });

  window.addEventListener('hashchange',() => {
    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  })
  </script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
<link rel="alternate" type="application/rss+xml" title="Blog" href="index.xml" data-external="1"></head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rdatatable"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/@r_data_table"> <i class="bi bi-mastodon" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://bsky.app/profile/rdatatable.bsky.social"> <i class="bi bi-cloud" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/r_data_table"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:r.data.table@gmail.com"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Comparing <code>data.table</code> reshape to <code>duckdb</code> and <code>polars</code></h1>
                                <div class="quarto-categories">
                <div class="quarto-category">tips</div>
                <div class="quarto-category">tutorials</div>
                <div class="quarto-category">developer</div>
                <div class="quarto-category">benchmarks</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Toby Dylan Hocking </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 17, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    <h5 class="quarto-listing-category-title">Categories</h5><div class="quarto-listing-category category-default"><div class="category" data-category="">All <span class="quarto-category-count">(27)</span></div><div class="category" data-category="YW1iYXNzYWRvcnM=">ambassadors <span class="quarto-category-count">(2)</span></div><div class="category" data-category="YW5ub3VuY2VtZW50cw==">announcements <span class="quarto-category-count">(8)</span></div><div class="category" data-category="YXBwbGljYXRpb24lMjBwYWNrYWdl">application package <span class="quarto-category-count">(1)</span></div><div class="category" data-category="YnJpZGdlJTIwcGFja2FnZQ==">bridge package <span class="quarto-category-count">(2)</span></div><div class="category" data-category="Y29tbXVuaXR5">community <span class="quarto-category-count">(4)</span></div><div class="category" data-category="Y29uZmVyZW5jZXM=">conferences <span class="quarto-category-count">(1)</span></div><div class="category" data-category="ZGV2ZWxvcGVy">developer <span class="quarto-category-count">(5)</span></div><div class="category" data-category="ZG9jdW1lbnRhdGlvbg==">documentation <span class="quarto-category-count">(2)</span></div><div class="category" data-category="ZXh0ZW5zaW9uJTIwcGFja2FnZQ==">extension package <span class="quarto-category-count">(1)</span></div><div class="category" data-category="ZnVuZGluZyUyMG9wcG9ydHVuaXR5">funding opportunity <span class="quarto-category-count">(2)</span></div><div class="category" data-category="Z2l0aHViJTIwYWN0aW9u">github action <span class="quarto-category-count">(1)</span></div><div class="category" data-category="Z292ZXJuYW5jZQ==">governance <span class="quarto-category-count">(2)</span></div><div class="category" data-category="Z3JhbnQ=">grant <span class="quarto-category-count">(10)</span></div><div class="category" data-category="Z3Vlc3QlMjBwb3N0">guest post <span class="quarto-category-count">(4)</span></div><div class="category" data-category="b3Bpbmlvbg==">opinion <span class="quarto-category-count">(1)</span></div><div class="category" data-category="cGFydG5lciUyMHBhY2thZ2U=">partner package <span class="quarto-category-count">(1)</span></div><div class="category" data-category="cGVyZm9ybWFuY2U=">performance <span class="quarto-category-count">(2)</span></div><div class="category" data-category="cGVyZm9ybWFuY2UlMjB0ZXN0aW5n">performance testing <span class="quarto-category-count">(1)</span></div><div class="category" data-category="cmVsZWFzZXM=">releases <span class="quarto-category-count">(1)</span></div><div class="category" data-category="c2VhbCUyMG9mJTIwYXBwcm92YWw=">seal of approval <span class="quarto-category-count">(6)</span></div><div class="category" data-category="dGVzdGluZw==">testing <span class="quarto-category-count">(2)</span></div><div class="category" data-category="dGlwcw==">tips <span class="quarto-category-count">(3)</span></div><div class="category" data-category="dHJhbnNsYXRpb24=">translation <span class="quarto-category-count">(1)</span></div><div class="category" data-category="dHJhdmVs">travel <span class="quarto-category-count">(1)</span></div><div class="category" data-category="dHV0b3JpYWxz">tutorials <span class="quarto-category-count">(5)</span></div></div></div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>One element of <a href="https://rdatatable-community.github.io/The-Raft/posts/2023-10-15-intro_to_grant-toby_hocking/">the NSF POSE grant for <code>data.table</code></a> is to create benchmarks which can inform users about when <code>data.table</code> could be more performant than similar software. Two examples of similar software are <code>duckdb</code> and <code>polars</code>, which each provide in-memory database operations. This post explores the differences in computational requirements, and in functionality, for data reshaping operations.</p>
<section id="terminology-and-functions-in-r-data.table-and-sql" class="level1">
<h1>Terminology and functions in R, <code>data.table</code>, and SQL</h1>
<p>Data reshaping means changing the shape of the data, in order to get it into a more appropriate format, for learning/plotting/etc. In R we use the terms “wide” (many columns, few rows) and “long” (few columns, many rows) to describe the different data shapes (and these terms come from <code>?stats::reshape</code>), whereas in SQL we use the terms “pivoted” and “unpivoted” to describe these two table types.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>R table type</th>
<th>SQL table type</th>
<th>rows</th>
<th>columns</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>long</td>
<td>unpivoted</td>
<td>many</td>
<td>few</td>
</tr>
<tr class="even">
<td>wide</td>
<td>pivoted</td>
<td>few</td>
<td>many</td>
</tr>
</tbody>
</table>
<p>For the wide-to-long reshape operation, <code>data.table</code> has <code>melt()</code> and SQL has <code>UNPIVOT</code>; for the long-to-wide reshape operation, <code>data.table</code> has <code>dcast()</code> and SQL has <code>PIVOT</code>.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Reshape operation</th>
<th><code>data.table</code> function</th>
<th>SQL function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Wide-to-long</td>
<td><code>melt</code></td>
<td><code>UNPIVOT</code></td>
</tr>
<tr class="even">
<td>Long-to-wide</td>
<td><code>dcast</code></td>
<td><code>PIVOT</code></td>
</tr>
</tbody>
</table>
</section>
<section id="wide-to-long-operations" class="level1">
<h1>Wide-to-long operations</h1>
<p>We begin with a discussion of wide-to-long reshape operations, also known as unpivot in SQL.</p>
<section id="wide-to-long-data-reshape-unpivot-using-data.tablemelt" class="level2">
<h2 class="anchored" data-anchor-id="wide-to-long-data-reshape-unpivot-using-data.tablemelt">Wide-to-long data reshape (unpivot) using <code>data.table::melt</code></h2>
<p>Wide-to-long reshape is often necessary before plotting. It is perhaps best explained using a simple example. Here we consider the iris data, which has four numeric columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>(iris.wide <span class="ot">&lt;-</span> <span class="fu">data.table</span>(iris))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
            &lt;num&gt;       &lt;num&gt;        &lt;num&gt;       &lt;num&gt;    &lt;fctr&gt;
  1:          5.1         3.5          1.4         0.2    setosa
  2:          4.9         3.0          1.4         0.2    setosa
  3:          4.7         3.2          1.3         0.2    setosa
  4:          4.6         3.1          1.5         0.2    setosa
  5:          5.0         3.6          1.4         0.2    setosa
 ---                                                            
146:          6.7         3.0          5.2         2.3 virginica
147:          6.3         2.5          5.0         1.9 virginica
148:          6.5         3.0          5.2         2.0 virginica
149:          6.2         3.4          5.4         2.3 virginica
150:          5.9         3.0          5.1         1.8 virginica</code></pre>
</div>
</div>
<p>What if we wanted to make a facetted histogram of the numeric iris data columns, with one panel/facet for each column? With ggplots we would use <code>geom_histogram(aes(numeric_variable))</code>, where <code>numeric_variable</code> would be the column name of a data table containing all of the numbers that we want to show in the histogram. To construct that table, we would have to first reshape to “long” (or unpivoted) format. To easily understand what the reshape operation does, we show a subset of the data (first and last rows) below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>(two.iris.wide <span class="ot">&lt;-</span> iris.wide[<span class="fu">c</span>(<span class="dv">1</span>,.N)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
          &lt;num&gt;       &lt;num&gt;        &lt;num&gt;       &lt;num&gt;    &lt;fctr&gt;
1:          5.1         3.5          1.4         0.2    setosa
2:          5.9         3.0          5.1         1.8 virginica</code></pre>
</div>
</div>
<p>Note the table above has 8 numbers, arranged into a table of 2 rows and 4 columns. To reshape these data to “long” (or unpivoted) format, we can use <code>data.table::melt</code>, as in the code below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">melt</span>(two.iris.wide, <span class="at">measure.vars=</span><span class="fu">measure</span>(part, dim, <span class="at">sep=</span><span class="st">"."</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Species   part    dim value
      &lt;fctr&gt; &lt;char&gt; &lt;char&gt; &lt;num&gt;
1:    setosa  Sepal Length   5.1
2: virginica  Sepal Length   5.9
3:    setosa  Sepal  Width   3.5
4: virginica  Sepal  Width   3.0
5:    setosa  Petal Length   1.4
6: virginica  Petal Length   5.1
7:    setosa  Petal  Width   0.2
8: virginica  Petal  Width   1.8</code></pre>
</div>
</div>
<p>Note the table above has the same 8 numbers, but arranged into 1 column in a table with 8 rows, which is the desired input for ggplots. Also note that the reshaped column names (<code>Petal.Length</code>, <code>Sepal.Width</code>, etc) each consist of two components, which become two different columns in the output: <code>part</code> (<code>Sepal</code> or <code>Petal</code>) and <code>dim</code> (<code>Length</code> or <code>Width</code>). In the code above, we used <code>sep="."</code> to specify that we want to split all of the iris column names using a dot, and then reshape all of the columns whose names split into the max number of items. The corresponding column names of the output are specified as the arguments of <code>measure()</code>, and for more info about this functionality, please read <a href="https://rdatatable.gitlab.io/data.table/reference/measure.html">its man page</a>.</p>
<p>Below we do the same reshape with the full iris data set, this time using a regular expression (instead of the <code>sep</code> argument used above),</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(iris.long <span class="ot">&lt;-</span> <span class="fu">melt</span>(iris.wide, <span class="at">measure.vars=</span><span class="fu">measure</span>(part, dim, <span class="at">pattern=</span><span class="st">"(.*)[.](.*)"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Species   part    dim value
        &lt;fctr&gt; &lt;char&gt; &lt;char&gt; &lt;num&gt;
  1:    setosa  Sepal Length   5.1
  2:    setosa  Sepal Length   4.9
  3:    setosa  Sepal Length   4.7
  4:    setosa  Sepal Length   4.6
  5:    setosa  Sepal Length   5.0
 ---                              
596: virginica  Petal  Width   2.3
597: virginica  Petal  Width   1.9
598: virginica  Petal  Width   2.0
599: virginica  Petal  Width   2.3
600: virginica  Petal  Width   1.8</code></pre>
</div>
</div>
<p>In the code above, the <code>pattern</code> argument is a Perl-compatible regular expression, and columns that match the pattern will be reshaped. The pattern must contain the same number of capture groups (parentheses) as the number of other arguments to melt (part and dim), which are used for output column names. After reshaping, we plot the data in a histogram:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    value),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">bins=</span><span class="dv">50</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>iris.long)<span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(part <span class="sc">~</span> dim, <span class="at">labeller=</span>label_both)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/dcast-hist-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see in the plot above that there is a top strip for each <code>dim</code> and a right strip for each <code>part</code>, and each facet/panel contains a histogram of the corresponding subset of data.</p>
</section>
<section id="wide-to-long-reshape-via-unpivot-in-polars" class="level2">
<h2 class="anchored" data-anchor-id="wide-to-long-reshape-via-unpivot-in-polars">Wide-to-long reshape via unpivot in <code>polars</code></h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="seal_polar.png" class="img-fluid figure-img" style="width:40.0%"></p>
<figcaption>We’re all friends here.</figcaption>
</figure>
</div>
<p><code>polars</code> is an implementation of data frames in Rust, with bindings in R and Python. In <code>polars</code>, the wide-to-long data reshape operation is documented on the <a href="https://docs.pola.rs/api/python/stable/reference/dataframe/api/polars.DataFrame.unpivot.html#polars.DataFrame.unpivot">man page for unpivot</a>, which explains that we must specify <code>index</code> and/or <code>on</code> (no support for separator, nor regex). In our case, we use the code below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(iris.long.polars <span class="ot">&lt;-</span> polars<span class="sc">::</span><span class="fu">as_polars_df</span>(iris)<span class="sc">$</span><span class="fu">unpivot</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">index=</span><span class="st">"Species"</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">on=</span><span class="fu">c</span>(<span class="st">"Sepal.Length"</span>,<span class="st">"Petal.Length"</span>,<span class="st">"Sepal.Width"</span>,<span class="st">"Petal.Width"</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable_name=</span><span class="st">"part.dim"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">value_name=</span><span class="st">"cm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (600, 3)
┌───────────┬──────────────┬─────┐
│ Species   ┆ part.dim     ┆ cm  │
│ ---       ┆ ---          ┆ --- │
│ cat       ┆ str          ┆ f64 │
╞═══════════╪══════════════╪═════╡
│ setosa    ┆ Sepal.Length ┆ 5.1 │
│ setosa    ┆ Sepal.Length ┆ 4.9 │
│ setosa    ┆ Sepal.Length ┆ 4.7 │
│ setosa    ┆ Sepal.Length ┆ 4.6 │
│ setosa    ┆ Sepal.Length ┆ 5.0 │
│ …         ┆ …            ┆ …   │
│ virginica ┆ Petal.Width  ┆ 2.3 │
│ virginica ┆ Petal.Width  ┆ 1.9 │
│ virginica ┆ Petal.Width  ┆ 2.0 │
│ virginica ┆ Petal.Width  ┆ 2.3 │
│ virginica ┆ Petal.Width  ┆ 1.8 │
└───────────┴──────────────┴─────┘</code></pre>
</div>
</div>
<p>The output above is analogous to the result from <code>data.table::melt</code>, but with one column named <code>part.dim</code> instead of the two columns named <code>part</code> and <code>dim</code>, because <code>polars</code> does not support splitting the reshaped column names into more than one output column. So with <code>polars</code>, if we wanted separate <code>part</code> and <code>dim</code> columns, we would have to specify that in a separate step, after the reshape. Or we could just use <code>facet_wrap</code> instead of <code>facet_grid</code>, as in the code below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    cm),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">bins=</span><span class="dv">50</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>iris.long.polars)<span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> part.dim, <span class="at">labeller=</span>label_both)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/polars-hist-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see in the plot above that there is a facet for each of the variables, but only one <code>part.dim</code> strip for each, instead of two strips (<code>part</code> and <code>dim</code>), as was the case for the previous plot.</p>
<section id="wide-to-long-reshape-via-unpivot-in-duckdb" class="level3">
<h3 class="anchored" data-anchor-id="wide-to-long-reshape-via-unpivot-in-duckdb">Wide-to-long reshape via UNPIVOT in <code>duckdb</code></h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="seal_duck.jpg" class="img-fluid figure-img" style="width:40.0%"></p>
<figcaption>(Image generated with Adobe Firefly.)</figcaption>
</figure>
</div>
<p><code>duckdb</code> is a column-oriented database implemented in C++, with an R package that supports a DBI-compliant SQL interface. That means that we use R functions like <code>DBI::dbGetQuery</code> to get results, just like we would with any other database (Postgres, MySQL, etc). This is documented in the <a href="https://duckdb.org/docs/api/r.html"><code>duckdb</code> R API</a> docs, which explain how to create a database connection, and then copy data from R to the database, as in the code below,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>(), <span class="at">dbdir =</span> <span class="st">":memory:"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>DBI<span class="sc">::</span><span class="fu">dbWriteTable</span>(con, <span class="st">"iris_wide"</span>, iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <a href="https://duckdb.org/docs/sql/statements/unpivot.html"><code>duckdb</code> unpivot man page</a> explains how to do wide-to-long reshape operations, which requires specifying names of columns to reshape (no support for separator, nor regex). In our case, we use the code below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>iris.long.duckdb <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbGetQuery</span>(con, <span class="st">'</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="st">UNPIVOT iris_wide</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="st">ON "Sepal.Length", "Petal.Length", "Sepal.Width", "Petal.Width" </span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="st">INTO NAME part_dim </span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="st">VALUE cm'</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(iris.long.duckdb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   600 obs. of  3 variables:
 $ Species : Factor w/ 3 levels "setosa","versicolor",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ part_dim: chr  "Sepal.Length" "Petal.Length" "Sepal.Width" "Petal.Width" ...
 $ cm      : num  5.1 1.4 3.5 0.2 4.9 1.4 3 0.2 4.7 1.3 ...</code></pre>
</div>
</div>
<p>Above we use <code>str</code> to show a brief summary of the structure of the output, which is a <code>data.frame</code> with 600 rows. With <code>duckdb</code>, the output has one column named <code>part_dim</code> (dots in column names are not allowed so we use an underscore here instead), because it does not support splitting the reshaped column names into more than one output column. So with <code>duckdb</code>, if we wanted separate <code>part</code> and <code>dim</code> columns, we would have to specify that in a separate step, after the reshape.</p>
</section>
</section>
<section id="creating-part-and-dim-columns" class="level2">
<h2 class="anchored" data-anchor-id="creating-part-and-dim-columns">Creating <code>part</code> and <code>dim</code> columns</h2>
<p>Both <code>polars</code> and <code>duckdb</code> are not capable of producing the separate <code>part</code> and <code>dim</code> columns during the reshape operation, but we can always do it as a post-processing step. One way to do that, by specifying a separator, would be via <code>data.table::tstrsplit</code>, as in the code below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.table</span>(iris.long.duckdb)[</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>, <span class="fu">c</span>(<span class="st">"part"</span>,<span class="st">"dim"</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">tstrsplit</span>(part_dim, <span class="at">split=</span><span class="st">"[.]"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>][]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Species     part_dim    cm   part    dim
        &lt;fctr&gt;       &lt;char&gt; &lt;num&gt; &lt;char&gt; &lt;char&gt;
  1:    setosa Sepal.Length   5.1  Sepal Length
  2:    setosa Petal.Length   1.4  Petal Length
  3:    setosa  Sepal.Width   3.5  Sepal  Width
  4:    setosa  Petal.Width   0.2  Petal  Width
  5:    setosa Sepal.Length   4.9  Sepal Length
 ---                                           
596: virginica  Petal.Width   2.3  Petal  Width
597: virginica Sepal.Length   5.9  Sepal Length
598: virginica Petal.Length   5.1  Petal Length
599: virginica  Sepal.Width   3.0  Sepal  Width
600: virginica  Petal.Width   1.8  Petal  Width</code></pre>
</div>
</div>
<p>The code above first converts to <code>data.table</code>, then uses the square brackets to assign new columns. Inside the square brackets, there is a walrus assignment:</p>
<ul>
<li><code>,</code> comma because there is no first argument (no subset, use all rows)</li>
<li><code>c("part","dim")</code> is the left side of the walrus <code>:=</code> assignment, which specifies the new column names to create.</li>
<li>on the right side of the walrus, the result of <code>tstrsplit(part_dim,   split="[.]")</code> is used as the value to assign to the new columns (<code>part_dim</code> is the column to split, and <code>"[.]"</code> is the regex to use for splitting).</li>
<li>Since <code>tstrsplit</code> returns a list of two character vectors, there will be two new columns.</li>
</ul>
<p>Finally after the walrus square brackets, we use another empty square brackets <code>[]</code> to enable printing (there is no printing immediately after assigning new columns using the walrus operator).</p>
<p>Another way of doing that, by specifying a regex, would be via <code>nc::capture_first_df</code> (recently given the <code>data.table</code> <a href="https://rdatatable-community.github.io/The-Raft/posts/2024-08-01-seal_of_approval-nc/">Seal of Approval</a>), as in the code below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>nc<span class="sc">::</span><span class="fu">capture_first_df</span>(iris.long.duckdb, <span class="at">part_dim=</span><span class="fu">list</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">part=</span><span class="st">".*"</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"[.]"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dim=</span><span class="st">".*"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Species     part_dim    cm   part    dim
        &lt;fctr&gt;       &lt;char&gt; &lt;num&gt; &lt;char&gt; &lt;char&gt;
  1:    setosa Sepal.Length   5.1  Sepal Length
  2:    setosa Petal.Length   1.4  Petal Length
  3:    setosa  Sepal.Width   3.5  Sepal  Width
  4:    setosa  Petal.Width   0.2  Petal  Width
  5:    setosa Sepal.Length   4.9  Sepal Length
 ---                                           
596: virginica  Petal.Width   2.3  Petal  Width
597: virginica Sepal.Length   5.9  Sepal Length
598: virginica Petal.Length   5.1  Petal Length
599: virginica  Sepal.Width   3.0  Sepal  Width
600: virginica  Petal.Width   1.8  Petal  Width</code></pre>
</div>
</div>
<p>The code above specifies:</p>
<ul>
<li><code>capture_first_df</code>, a function for applying capturing regex to columns of a data frame;</li>
<li><code>iris.long.duckdb</code> is the input data frame, in which there is the <code>part_dim</code> column to split;</li>
<li><code>part=".*", "[.]", dim=".*"</code> makes the capturing regex; R argument names are used to define the new column names, based on the text captured in the corresponding regex (<code>".*"</code> means zero or more non-newline characters).</li>
</ul>
<p>Both results above are data tables with extra cols <code>part</code> and <code>dim</code>. For visualization, these data tables could be used with either <code>facet_grid</code> or <code>facet_wrap</code>, similar to the examples above.</p>
</section>
<section id="reshape-into-multiple-columns" class="level2">
<h2 class="anchored" data-anchor-id="reshape-into-multiple-columns">Reshape into multiple columns</h2>
<p>Another kind of wide-to-long reshape involves reshaping into multiple columns. For example, in the iris data, we may wonder whether sepals are larger than petals (in terms of both length and width). To answer that question, we could make a scatterplot of <code>y=Sepal</code> versus <code>x=Petal</code>, with a facet/panel for each dimension (<code>Length</code> and <code>Width</code>). In the ggplot system, we would need to compute a data table with columns <code>Sepal</code>, <code>Petal</code>, and <code>dim</code>, and we can do that by specifying the <code>value.name</code> keyword to <code>measure()</code>, as in the code below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>(iris.long.parts <span class="ot">&lt;-</span> <span class="fu">melt</span>(iris.wide, <span class="at">measure.vars=</span><span class="fu">measure</span>(value.name, dim, <span class="at">sep=</span><span class="st">"."</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Species    dim Sepal Petal
        &lt;fctr&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt;
  1:    setosa Length   5.1   1.4
  2:    setosa Length   4.9   1.4
  3:    setosa Length   4.7   1.3
  4:    setosa Length   4.6   1.5
  5:    setosa Length   5.0   1.4
 ---                             
296: virginica  Width   3.0   2.3
297: virginica  Width   2.5   1.9
298: virginica  Width   3.0   2.0
299: virginica  Width   3.4   2.3
300: virginica  Width   3.0   1.8</code></pre>
</div>
</div>
<p>Again, the <code>measure()</code> function in the code above operates by splitting the input column names using <code>sep</code>, which results in two groups (<code>Sepal.Width</code> split into <code>Sepal</code> and <code>Width</code>, etc) for each of the measured columns. The <code>value.name</code> keyword indicates that each unique value in the first group (<code>Sepal</code> and <code>Petal</code>) should be used as the name of an output column. This functionality can be very convenient for some data reshaping tasks, but it is neither supported in <code>polars</code>, nor in <code>duckdb</code>. Going back to our original motivating problem, we can make the scatterplot using the code below,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>, <span class="at">color=</span><span class="st">"grey"</span>)<span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    Petal, Sepal),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>iris.long.parts)<span class="sc">+</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> dim, <span class="at">labeller=</span>label_both)<span class="sc">+</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/iris-scatter-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the plot above, we see that all of the data points (black) are above the y=x line (grey), so we can conclude that sepals are indeed larger than petals, in terms of both length and width.</p>
</section>
<section id="wide-to-long-performance-comparison" class="level2">
<h2 class="anchored" data-anchor-id="wide-to-long-performance-comparison">Wide-to-long performance comparison</h2>
<p>We may also wonder which data reshaping functions work fastest for large data. To answer that question, we will use <code>atime</code>, which is an R package that allows us to see how much time/memory is required for computations in R, as a function of data size <code>N</code>. In the <code>setup</code> argument of the code below, we repeat the iris data for a certain number of rows <code>N</code>. The code in the other arguments is run for the time/memory measurement, and is very similar to the code presented in previous sections. One difference is that for <code>data.table</code> we use <code>id.vars</code> instead of <code>measure()</code>, to more closely match the arguments provided to the other unpivot functions (for a more fair comparison).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>seconds.limit <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>unpivot.res <span class="ot">&lt;-</span> atime<span class="sc">::</span><span class="fu">atime</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">N=</span><span class="dv">2</span><span class="sc">^</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">50</span>),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">setup=</span>{</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    (row.id.vec <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">+</span>(<span class="fu">seq</span>(<span class="dv">0</span>,N<span class="dv">-1</span>) <span class="sc">%%</span> <span class="fu">nrow</span>(iris)))</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    N.df <span class="ot">&lt;-</span> iris[row.id.vec,]</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    N.dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(N.df)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    polars_df <span class="ot">&lt;-</span> polars<span class="sc">::</span><span class="fu">as_polars_df</span>(N.df)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    duckdb<span class="sc">::</span><span class="fu">dbWriteTable</span>(con, <span class="st">"iris_table"</span>, N.df, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">seconds.limit=</span>seconds.limit,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"duckdb</span><span class="sc">\n</span><span class="st">UNPIVOT"</span><span class="ot">=</span>DBI<span class="sc">::</span><span class="fu">dbGetQuery</span>(con, <span class="st">'UNPIVOT iris_table ON "Sepal.Length", "Petal.Length", "Sepal.Width", "Petal.Width" INTO NAME part_dim VALUE cm'</span>),</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"polars</span><span class="sc">\n</span><span class="st">unpivot"</span><span class="ot">=</span>polars_df<span class="sc">$</span><span class="fu">unpivot</span>(<span class="at">index=</span><span class="st">"Species"</span>, <span class="at">value_name=</span><span class="st">"cm"</span>),</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data.table</span><span class="sc">\n</span><span class="st">melt"</span><span class="ot">=</span><span class="fu">melt</span>(N.dt, <span class="at">id.vars=</span><span class="st">"Species"</span>, <span class="at">value.name=</span><span class="st">"cm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Some expressions had a GC in every iteration; so filtering is
disabled.
Warning: Some expressions had a GC in every iteration; so filtering is
disabled.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>unpivot.refs <span class="ot">&lt;-</span> atime<span class="sc">::</span><span class="fu">references_best</span>(unpivot.res)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>unpivot.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(unpivot.refs)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(unpivot.pred)<span class="sc">+</span><span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="fl">1e1</span>,<span class="fl">1e7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: directlabels</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in ggplot2::scale_x_log10("N", breaks = meas[,
10^seq(ceiling(min(log10(N))), : log-10 transformation introduced infinite
values.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/atime-unpivot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In the plot above, the computation time in seconds is plotted as a function of <code>N</code>, the number of input rows to reshape. The horizontal reference line is drawn at 0.1 seconds, and the <code>N</code> highlighted corresponds to the throughput given that time limit. When we compare the <code>N</code> values shown for the different methods, we see that <code>data.table</code> is comparable to <code>polars</code> (within 2x), and both are much faster than <code>duckdb</code> (about 10x).</p>
<p>Above there are several confounding factors in the comparison, most notably that data must be copied to <code>duckdb</code> and <code>polars</code> before and after processing. In contrast, <code>data.table</code> provides <code>setDT</code> and <code>setDF</code> functions, which can convert to/from data tables, without copying. So when data originates in R, or needs to come back to R, we should include the copy time for a more fair comparison. Below we run that comparison:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>seconds.limit <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>unpivot.copy.res <span class="ot">&lt;-</span> atime<span class="sc">::</span><span class="fu">atime</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">N=</span><span class="dv">2</span><span class="sc">^</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">50</span>),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">setup=</span>{</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    (row.id.vec <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">+</span>(<span class="fu">seq</span>(<span class="dv">0</span>,N<span class="dv">-1</span>) <span class="sc">%%</span> <span class="fu">nrow</span>(iris)))</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    N.df <span class="ot">&lt;-</span> iris[row.id.vec,]</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seconds.limit=</span>seconds.limit,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"duckdb</span><span class="sc">\n</span><span class="st">copy+UNPIVOT"</span><span class="ot">=</span>{</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    duckdb<span class="sc">::</span><span class="fu">dbWriteTable</span>(con, <span class="st">"iris_table"</span>, N.df, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    DBI<span class="sc">::</span><span class="fu">dbGetQuery</span>(con, <span class="st">'UNPIVOT iris_table ON "Sepal.Length", "Petal.Length", "Sepal.Width", "Petal.Width" INTO NAME part_dim VALUE cm'</span>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"polars</span><span class="sc">\n</span><span class="st">copy+unpivot"</span><span class="ot">=</span>{</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    polars_df <span class="ot">&lt;-</span> polars<span class="sc">::</span><span class="fu">as_polars_df</span>(N.df)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    polars_unpivot <span class="ot">&lt;-</span> polars_df<span class="sc">$</span><span class="fu">unpivot</span>(<span class="at">index=</span><span class="st">"Species"</span>, <span class="at">value_name=</span><span class="st">"cm"</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>(polars_unpivot)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data.table</span><span class="sc">\n</span><span class="st">set+melt"</span><span class="ot">=</span><span class="fu">setDF</span>(<span class="fu">melt</span>(<span class="fu">setDT</span>(N.df), <span class="at">id.vars=</span><span class="st">"Species"</span>, <span class="at">value.name=</span><span class="st">"cm"</span>)))</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>unpivot.copy.refs <span class="ot">&lt;-</span> atime<span class="sc">::</span><span class="fu">references_best</span>(unpivot.copy.res)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>unpivot.copy.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(unpivot.copy.refs)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(unpivot.copy.pred)<span class="sc">+</span><span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="fl">1e1</span>,<span class="fl">1e7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in ggplot2::scale_x_log10("N", breaks = meas[,
10^seq(ceiling(min(log10(N))), : log-10 transformation introduced infinite
values.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/atime-unpivot-copy-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The result above shows that <code>data.table</code> is most efficient in terms of computation time. In this comparison, <code>data.table</code> is clearly faster than <code>polars</code> (about 10x), and much faster than <code>duckdb</code> (about 100x).</p>
</section>
<section id="wide-to-long-summary-of-functionality" class="level2">
<h2 class="anchored" data-anchor-id="wide-to-long-summary-of-functionality">Wide-to-long summary of functionality</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="wide_long.jpeg" class="img-fluid figure-img" style="width:40.0%"></p>
<figcaption>Wide to long.</figcaption>
</figure>
</div>
<p>In this section, we showed that <code>data.table</code> provides an efficient and feature-rich implementation of wide-to-long data reshaping.</p>
<ul>
<li><p><code>measure()</code> allows specification of columns to reshape using either a separator or a regular expression pattern. In contrast, <code>duckdb</code> nor <code>polars</code> require specifying input column names (no support for separator, nor regex), and output column post-processing, which is less convenient.</p></li>
<li><p>The <code>value.name</code> keyword can be used to reshape into multiple output columns, which is required for some kinds of reshape operations (no way to do that in <code>duckdb</code>/<code>polars</code>).</p></li>
<li><p><code>setDT</code> and <code>setDF</code> can be used to avoid un-necessary copies with <code>data.table</code>. In contrast, <code>duckdb</code>/<code>polars</code> require copies to/from regular R memory, which can add significant time/memory requirements.</p></li>
<li><p><code>data.table</code> was fastest and most memory efficient in the comparisons we examined (both with and without consideration of copying).</p></li>
</ul>
<p>The table below summarizes support for different features in each software package (dash - means no support).</p>
<table class="caption-top table">
<colgroup>
<col style="width: 32%">
<col style="width: 25%">
<col style="width: 23%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th>how to specify</th>
<th><code>data.table</code></th>
<th><code>polars</code></th>
<th><code>duckdb</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>function</td>
<td><code>melt</code></td>
<td><code>unpivot</code></td>
<td><code>UNPIVOT</code></td>
</tr>
<tr class="even">
<td>reshape cols</td>
<td><code>measure.vars</code></td>
<td><code>on</code></td>
<td><code>ON</code></td>
</tr>
<tr class="odd">
<td>other cols</td>
<td><code>id.vars</code></td>
<td><code>index</code></td>
<td>-</td>
</tr>
<tr class="even">
<td>output name (data)</td>
<td><code>value.name</code></td>
<td><code>value_name</code></td>
<td><code>VALUE</code></td>
</tr>
<tr class="odd">
<td>output name (columns)</td>
<td><code>variable.name</code></td>
<td><code>variable_name</code></td>
<td><code>INTO NAME</code></td>
</tr>
<tr class="even">
<td>separator</td>
<td><code>sep</code></td>
<td>-</td>
<td>-</td>
</tr>
<tr class="odd">
<td>regex</td>
<td><code>pattern</code></td>
<td>-</td>
<td>-</td>
</tr>
<tr class="even">
<td>multiple outputs</td>
<td><code>value.name</code></td>
<td>-</td>
<td>-</td>
</tr>
<tr class="odd">
<td>avoid copies</td>
<td><code>setDT</code>, <code>setDF</code></td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="long-to-wide-operations" class="level1">
<h1>Long-to-wide operations</h1>
<p>Another kind of reshape operation starts with a long table (many rows, few cols), and creates a wide table (many cols, few rows). I frequently use this operation when comparing results of machine learning algorithms (computing mean/SD over folds, p-values, etc). For examples of those use cases, please read my blog about <a href="https://tdhock.github.io/blog/2024/viz-pred-err/">Visualizing prediction error</a>.</p>
<section id="long-to-wide-data-reshape-using-data.tabledcast" class="level2">
<h2 class="anchored" data-anchor-id="long-to-wide-data-reshape-using-data.tabledcast">Long-to-wide data reshape using <code>data.table::dcast</code></h2>
<p>Here we continue with the iris data example. We will present three different reshape operations involving the iris data. The code below adds a column <code>flower</code> which contains the row number.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>iris.wide[, flower <span class="sc">:</span><span class="er">=</span> .I][]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species flower
            &lt;num&gt;       &lt;num&gt;        &lt;num&gt;       &lt;num&gt;    &lt;fctr&gt;  &lt;int&gt;
  1:          5.1         3.5          1.4         0.2    setosa      1
  2:          4.9         3.0          1.4         0.2    setosa      2
  3:          4.7         3.2          1.3         0.2    setosa      3
  4:          4.6         3.1          1.5         0.2    setosa      4
  5:          5.0         3.6          1.4         0.2    setosa      5
 ---                                                                   
146:          6.7         3.0          5.2         2.3 virginica    146
147:          6.3         2.5          5.0         1.9 virginica    147
148:          6.5         3.0          5.2         2.0 virginica    148
149:          6.2         3.4          5.4         2.3 virginica    149
150:          5.9         3.0          5.1         1.8 virginica    150</code></pre>
</div>
</div>
<p>Then we do a wide-to-long reshape using the code below (same as previous section),</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>(iris.long.i <span class="ot">&lt;-</span> <span class="fu">melt</span>(iris.wide, <span class="at">measure.vars=</span><span class="fu">measure</span>(part, dim, <span class="at">sep=</span><span class="st">"."</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Species flower   part    dim value
        &lt;fctr&gt;  &lt;int&gt; &lt;char&gt; &lt;char&gt; &lt;num&gt;
  1:    setosa      1  Sepal Length   5.1
  2:    setosa      2  Sepal Length   4.9
  3:    setosa      3  Sepal Length   4.7
  4:    setosa      4  Sepal Length   4.6
  5:    setosa      5  Sepal Length   5.0
 ---                                     
596: virginica    146  Petal  Width   2.3
597: virginica    147  Petal  Width   1.9
598: virginica    148  Petal  Width   2.0
599: virginica    149  Petal  Width   2.3
600: virginica    150  Petal  Width   1.8</code></pre>
</div>
</div>
<p>The table above has an additional column for <code>flower</code>, which we use in the code below on the left side of the formula (used to define output rows), along with <code>part + dim</code> on the right side of the formula (used to define output columns). The code below can therefore be used to reshape the data back into their original wide format:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dcast</span>(<span class="co"># wide reshape 1</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>iris.long.i,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula=</span>flower <span class="sc">+</span> Species <span class="sc">~</span> part <span class="sc">+</span> dim,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep=</span><span class="st">"."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;flower, Species&gt;
     flower   Species Petal.Length Petal.Width Sepal.Length Sepal.Width
      &lt;int&gt;    &lt;fctr&gt;        &lt;num&gt;       &lt;num&gt;        &lt;num&gt;       &lt;num&gt;
  1:      1    setosa          1.4         0.2          5.1         3.5
  2:      2    setosa          1.4         0.2          4.9         3.0
  3:      3    setosa          1.3         0.2          4.7         3.2
  4:      4    setosa          1.5         0.2          4.6         3.1
  5:      5    setosa          1.4         0.2          5.0         3.6
 ---                                                                   
146:    146 virginica          5.2         2.3          6.7         3.0
147:    147 virginica          5.0         1.9          6.3         2.5
148:    148 virginica          5.2         2.0          6.5         3.0
149:    149 virginica          5.4         2.3          6.2         3.4
150:    150 virginica          5.1         1.8          5.9         3.0</code></pre>
</div>
</div>
<p>We can see that the result above is almost the same as the original iris data (but with the columns in a different order). Another kind of reshape involves computing an aggregation function, such as <code>mean</code>. Note in the code below that <code>.</code> on the right side of the formula indicates a single output column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dcast</span>(<span class="co"># wide reshape 2</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>iris.long.i,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula=</span>Species <span class="sc">+</span> part <span class="sc">+</span> dim <span class="sc">~</span> .,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.aggregate=</span>mean,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep=</span><span class="st">"."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;Species, part, dim&gt;
       Species   part    dim     .
        &lt;fctr&gt; &lt;char&gt; &lt;char&gt; &lt;num&gt;
 1:     setosa  Petal Length 1.462
 2:     setosa  Petal  Width 0.246
 3:     setosa  Sepal Length 5.006
 4:     setosa  Sepal  Width 3.428
 5: versicolor  Petal Length 4.260
 6: versicolor  Petal  Width 1.326
 7: versicolor  Sepal Length 5.936
 8: versicolor  Sepal  Width 2.770
 9:  virginica  Petal Length 5.552
10:  virginica  Petal  Width 2.026
11:  virginica  Sepal Length 6.588
12:  virginica  Sepal  Width 2.974</code></pre>
</div>
</div>
<p>The output above has a row for every unique combination of <code>Species</code>, <code>part</code>, and <code>dim</code>, and a column (<code>.</code>)` for the mean of the corresponding data. The more complex reshape below involves multiple aggregations, and multiple value variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">width=</span><span class="dv">100</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dcast</span>(<span class="co"># wide reshape 3</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>iris.long.parts,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula=</span>dim <span class="sc">~</span> Species,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.aggregate=</span><span class="fu">list</span>(mean,sd),</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.var=</span><span class="fu">c</span>(<span class="st">"Sepal"</span>,<span class="st">"Petal"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;dim&gt;
      dim Sepal_mean_setosa Sepal_mean_versicolor Sepal_mean_virginica Petal_mean_setosa
   &lt;char&gt;             &lt;num&gt;                 &lt;num&gt;                &lt;num&gt;             &lt;num&gt;
1: Length             5.006                 5.936                6.588             1.462
2:  Width             3.428                 2.770                2.974             0.246
   Petal_mean_versicolor Petal_mean_virginica Sepal_sd_setosa Sepal_sd_versicolor
                   &lt;num&gt;                &lt;num&gt;           &lt;num&gt;               &lt;num&gt;
1:                 4.260                5.552       0.3524897           0.5161711
2:                 1.326                2.026       0.3790644           0.3137983
   Sepal_sd_virginica Petal_sd_setosa Petal_sd_versicolor Petal_sd_virginica
                &lt;num&gt;           &lt;num&gt;               &lt;num&gt;              &lt;num&gt;
1:          0.6358796       0.1736640           0.4699110          0.5518947
2:          0.3224966       0.1053856           0.1977527          0.2746501</code></pre>
</div>
</div>
<p>The output above includes two rows, and a column for every unique combination of <code>value.var</code> (<code>Sepal</code> or <code>Petal</code>), of <code>fun.aggregate</code> (<code>mean</code> or <code>sd</code>), and of <code>Species</code> (<code>setosa</code>, <code>versicolor</code>, <code>virginica</code>).</p>
</section>
<section id="long-to-wide-reshape-in-polars" class="level2">
<h2 class="anchored" data-anchor-id="long-to-wide-reshape-in-polars">Long-to-wide reshape in <code>polars</code></h2>
<p><code>polars</code> supports long-to-wide reshape via <a href="https://docs.pola.rs/api/python/stable/reference/dataframe/api/polars.DataFrame.pivot.html">the <code>pivot</code> method</a>, as in the code below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>(polars.wide <span class="ot">&lt;-</span> polars<span class="sc">::</span><span class="fu">as_polars_df</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  iris.long.i</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">pivot</span>(<span class="co"># wide reshape 1</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">on=</span><span class="fu">c</span>(<span class="st">"part"</span>,<span class="st">"dim"</span>),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">index=</span><span class="fu">c</span>(<span class="st">"flower"</span>,<span class="st">"Species"</span>),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">values=</span><span class="st">"value"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (150, 6)
┌────────┬───────────┬───────────────────┬───────────────────┬──────────────────┬──────────────────┐
│ flower ┆ Species   ┆ {"Sepal","Length" ┆ {"Sepal","Width"} ┆ {"Petal","Length ┆ {"Petal","Width" │
│ ---    ┆ ---       ┆ }                 ┆ ---               ┆ "}               ┆ }                │
│ i32    ┆ cat       ┆ ---               ┆ f64               ┆ ---              ┆ ---              │
│        ┆           ┆ f64               ┆                   ┆ f64              ┆ f64              │
╞════════╪═══════════╪═══════════════════╪═══════════════════╪══════════════════╪══════════════════╡
│ 1      ┆ setosa    ┆ 5.1               ┆ 3.5               ┆ 1.4              ┆ 0.2              │
│ 2      ┆ setosa    ┆ 4.9               ┆ 3.0               ┆ 1.4              ┆ 0.2              │
│ 3      ┆ setosa    ┆ 4.7               ┆ 3.2               ┆ 1.3              ┆ 0.2              │
│ 4      ┆ setosa    ┆ 4.6               ┆ 3.1               ┆ 1.5              ┆ 0.2              │
│ 5      ┆ setosa    ┆ 5.0               ┆ 3.6               ┆ 1.4              ┆ 0.2              │
│ …      ┆ …         ┆ …                 ┆ …                 ┆ …                ┆ …                │
│ 146    ┆ virginica ┆ 6.7               ┆ 3.0               ┆ 5.2              ┆ 2.3              │
│ 147    ┆ virginica ┆ 6.3               ┆ 2.5               ┆ 5.0              ┆ 1.9              │
│ 148    ┆ virginica ┆ 6.5               ┆ 3.0               ┆ 5.2              ┆ 2.0              │
│ 149    ┆ virginica ┆ 6.2               ┆ 3.4               ┆ 5.4              ┆ 2.3              │
│ 150    ┆ virginica ┆ 5.9               ┆ 3.0               ┆ 5.1              ┆ 1.8              │
└────────┴───────────┴───────────────────┴───────────────────┴──────────────────┴──────────────────┘</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(polars.wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "flower"                 "Species"                "{\"Sepal\",\"Length\"}"
[4] "{\"Sepal\",\"Width\"}"  "{\"Petal\",\"Length\"}" "{\"Petal\",\"Width\"}" </code></pre>
</div>
</div>
<p>The output above is consistent with the results from <code>data.table::dcast</code>, and the original iris data, although the names are unusual (with curly braces and double quotes). The next reshape example below shows that we need to create a dummy variable to use as the <code>on</code> argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>polars<span class="sc">::</span><span class="fu">as_polars_df</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  iris.long.i[, <span class="at">dummy :=</span> <span class="st">"."</span>]</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">pivot</span>(<span class="co"># wide reshape 2</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">on=</span><span class="st">"dummy"</span>, <span class="co"># have to create dummy var for on.</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">index=</span><span class="fu">c</span>(<span class="st">"Species"</span>,<span class="st">"part"</span>,<span class="st">"dim"</span>),</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">values=</span><span class="st">"value"</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">aggregate_function=</span><span class="st">"mean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (12, 4)
┌────────────┬───────┬────────┬───────┐
│ Species    ┆ part  ┆ dim    ┆ .     │
│ ---        ┆ ---   ┆ ---    ┆ ---   │
│ cat        ┆ str   ┆ str    ┆ f64   │
╞════════════╪═══════╪════════╪═══════╡
│ setosa     ┆ Sepal ┆ Length ┆ 5.006 │
│ versicolor ┆ Sepal ┆ Length ┆ 5.936 │
│ virginica  ┆ Sepal ┆ Length ┆ 6.588 │
│ setosa     ┆ Sepal ┆ Width  ┆ 3.428 │
│ versicolor ┆ Sepal ┆ Width  ┆ 2.77  │
│ …          ┆ …     ┆ …      ┆ …     │
│ versicolor ┆ Petal ┆ Length ┆ 4.26  │
│ virginica  ┆ Petal ┆ Length ┆ 5.552 │
│ setosa     ┆ Petal ┆ Width  ┆ 0.246 │
│ versicolor ┆ Petal ┆ Width  ┆ 1.326 │
│ virginica  ┆ Petal ┆ Width  ┆ 2.026 │
└────────────┴───────┴────────┴───────┘</code></pre>
</div>
</div>
<p>The output above is consistent with the results from <code>data.table::dcast</code>. Currently <code>polars</code> only supports a single aggregation function, so we can not calculate both <code>mean</code> and <code>sd</code> at the same time, but we can at least do the <code>mean</code> for multiple <code>values</code> in the code below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>polars<span class="sc">::</span><span class="fu">as_polars_df</span>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  iris.long.parts</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">pivot</span>(<span class="co"># wide reshape 3</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">on=</span><span class="st">"Species"</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">index=</span><span class="st">"dim"</span>,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">values=</span><span class="fu">c</span>(<span class="st">"Sepal"</span>,<span class="st">"Petal"</span>),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">aggregate_function=</span><span class="st">"mean"</span>)<span class="co">#multiple agg not supported.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (2, 7)
┌────────┬──────────────┬──────────────┬──────────────┬──────────────┬──────────────┬──────────────┐
│ dim    ┆ Sepal_setosa ┆ Sepal_versic ┆ Sepal_virgin ┆ Petal_setosa ┆ Petal_versic ┆ Petal_virgin │
│ ---    ┆ ---          ┆ olor         ┆ ica          ┆ ---          ┆ olor         ┆ ica          │
│ str    ┆ f64          ┆ ---          ┆ ---          ┆ f64          ┆ ---          ┆ ---          │
│        ┆              ┆ f64          ┆ f64          ┆              ┆ f64          ┆ f64          │
╞════════╪══════════════╪══════════════╪══════════════╪══════════════╪══════════════╪══════════════╡
│ Length ┆ 5.006        ┆ 5.936        ┆ 6.588        ┆ 1.462        ┆ 4.26         ┆ 5.552        │
│ Width  ┆ 3.428        ┆ 2.77         ┆ 2.974        ┆ 0.246        ┆ 1.326        ┆ 2.026        │
└────────┴──────────────┴──────────────┴──────────────┴──────────────┴──────────────┴──────────────┘</code></pre>
</div>
</div>
<p>Above we see the result only has 6 columns (for <code>mean</code>), whereas the analogous result from <code>data.table::dcast</code> above had 12 columns (with additionally the <code>sd</code>).</p>
</section>
<section id="long-to-wide-reshape-in-duckdb" class="level2">
<h2 class="anchored" data-anchor-id="long-to-wide-reshape-in-duckdb">Long-to-wide reshape in <code>duckdb</code></h2>
<p><code>duckdb</code> supports long-to-wide reshape via <a href="https://duckdb.org/docs/sql/statements/pivot.html">the SQL <code>PIVOT</code> command</a>, which can be used to recover the original iris data via the command below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>duckdb<span class="sc">::</span><span class="fu">dbWriteTable</span>(con, <span class="st">"iris_long_i"</span>, iris.long.i, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>iris.wide.again.duckdb <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbGetQuery</span>(<span class="co"># wide reshape 1</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  con, <span class="st">'</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="st">PIVOT iris_long_i </span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="st">ON part,dim </span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="st">USING sum(value) </span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY flower,Species </span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY flower'</span>)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(iris.wide.again.duckdb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   150 obs. of  6 variables:
 $ flower      : int  1 2 3 4 5 6 7 8 9 10 ...
 $ Species     : Factor w/ 3 levels "setosa","versicolor",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ Petal_Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
 $ Petal_Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
 $ Sepal_Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
 $ Sepal_Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...</code></pre>
</div>
</div>
<p>We can see that the result above is consistent with the previous sections. The code below uses <code>mean</code> as an aggregation function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>DBI<span class="sc">::</span><span class="fu">dbGetQuery</span>(<span class="co"># wide reshape 2</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  con, <span class="st">'</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="st">PIVOT iris_long_i </span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="st">USING mean(value) </span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="st">AS "." </span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY Species,part,dim'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Species  part    dim     .
1  versicolor Petal Length 4.260
2  versicolor Petal  Width 1.326
3      setosa Sepal Length 5.006
4      setosa Sepal  Width 3.428
5   virginica Petal Length 5.552
6   virginica Petal  Width 2.026
7  versicolor Sepal Length 5.936
8   virginica Sepal Length 6.588
9  versicolor Sepal  Width 2.770
10  virginica Sepal  Width 2.974
11     setosa Petal Length 1.462
12     setosa Petal  Width 0.246</code></pre>
</div>
</div>
<p>The result above is consistent with previous results. Finally, we can do multiple aggregations via the code below, which requires enumerating each combination of aggregation function and input column to aggregate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>duckdb<span class="sc">::</span><span class="fu">dbWriteTable</span>(con, <span class="st">"iris_long_parts"</span>, iris.long.parts, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>DBI<span class="sc">::</span><span class="fu">dbGetQuery</span>(<span class="co"># wide reshape 3</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  con, <span class="st">'</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="st">PIVOT iris_long_parts </span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="st">ON Species </span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="st">USING </span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="st"> mean(Sepal) AS Sepal_mean, </span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="st"> stddev(Sepal) AS Sepal_sd, </span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="st"> mean(Petal) AS Petal_mean, </span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="st"> stddev(Petal) AS Petal_sd </span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY dim'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     dim setosa_Sepal_mean setosa_Sepal_sd setosa_Petal_mean setosa_Petal_sd versicolor_Sepal_mean
1 Length             5.006       0.3524897             1.462       0.1736640                 5.936
2  Width             3.428       0.3790644             0.246       0.1053856                 2.770
  versicolor_Sepal_sd versicolor_Petal_mean versicolor_Petal_sd virginica_Sepal_mean
1           0.5161711                 4.260           0.4699110                6.588
2           0.3137983                 1.326           0.1977527                2.974
  virginica_Sepal_sd virginica_Petal_mean virginica_Petal_sd
1          0.6358796                5.552          0.5518947
2          0.3224966                2.026          0.2746501</code></pre>
</div>
</div>
<p>The result above is consistent with the result from <code>data.table::dcast</code>. Because all combinations of aggregation/columns must be enumerated, the <code>duckdb</code> code is a bit more repetitive than the corresponding <code>data.table</code> code (which is more convenient).</p>
</section>
<section id="long-to-wide-performance-comparison" class="level2">
<h2 class="anchored" data-anchor-id="long-to-wide-performance-comparison">Long-to-wide performance comparison</h2>
<p>Below we conduct an <code>atime</code> benchmark to measure the computation time of the reshape operation (without controlling for the copy operation).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>seconds.limit <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>pivot.res <span class="ot">&lt;-</span> atime<span class="sc">::</span><span class="fu">atime</span>(</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">N=</span><span class="dv">2</span><span class="sc">^</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">50</span>),</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">setup=</span>{</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    (row.id.vec <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">+</span>(<span class="fu">seq</span>(<span class="dv">0</span>,N<span class="dv">-1</span>) <span class="sc">%%</span> <span class="fu">nrow</span>(iris.long.i)))</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    N.dt <span class="ot">&lt;-</span> iris.long.i[row.id.vec]</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    N.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(N.dt)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    N_polars <span class="ot">&lt;-</span> polars<span class="sc">::</span><span class="fu">as_polars_df</span>(N.df)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    duckdb<span class="sc">::</span><span class="fu">dbWriteTable</span>(con, <span class="st">"iris_long_i"</span>, N.df, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">seconds.limit=</span>seconds.limit,</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"duckdb</span><span class="sc">\n</span><span class="st">PIVOT"</span><span class="ot">=</span>DBI<span class="sc">::</span><span class="fu">dbGetQuery</span>(con, <span class="st">'PIVOT iris_long_i USING mean(value) AS "." GROUP BY Species,part,dim'</span>),</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"polars</span><span class="sc">\n</span><span class="st">pivot"</span><span class="ot">=</span>N_polars<span class="sc">$</span><span class="fu">pivot</span>(<span class="at">on=</span><span class="st">"dummy"</span>, <span class="at">index=</span><span class="fu">c</span>(<span class="st">"Species"</span>,<span class="st">"part"</span>,<span class="st">"dim"</span>), <span class="at">values=</span><span class="st">"value"</span>, <span class="at">aggregate_function=</span><span class="st">"mean"</span>),</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data.table</span><span class="sc">\n</span><span class="st">dcast"</span><span class="ot">=</span><span class="fu">dcast</span>(N.dt, Species <span class="sc">+</span> part <span class="sc">+</span> dim <span class="sc">~</span> ., mean))</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>pivot.refs <span class="ot">&lt;-</span> atime<span class="sc">::</span><span class="fu">references_best</span>(pivot.res)</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>pivot.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(pivot.refs)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pivot.pred)<span class="sc">+</span><span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="fl">1e1</span>,<span class="fl">1e7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in ggplot2::scale_x_log10("N", breaks = meas[, 10^seq(ceiling(min(log10(N))), : log-10
transformation introduced infinite values.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/atime-pivot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The result above shows that <code>data.table::dcast</code> is about as fast as the others (bottom facet), although <code>duckdb</code> is slightly faster, and <code>polars</code> is slightly slower (less than 2x). Below we run a more complex benchmark which also measures computation time for the copy operation (in addition to the reshape).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>seconds.limit <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>pivot.copy.res <span class="ot">&lt;-</span> atime<span class="sc">::</span><span class="fu">atime</span>(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">N=</span><span class="dv">2</span><span class="sc">^</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">50</span>),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">setup=</span>{</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    (row.id.vec <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">+</span>(<span class="fu">seq</span>(<span class="dv">0</span>,N<span class="dv">-1</span>) <span class="sc">%%</span> <span class="fu">nrow</span>(iris.long.i)))</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    N.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(iris.long.i[row.id.vec])</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seconds.limit=</span>seconds.limit,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"duckdb</span><span class="sc">\n</span><span class="st">copy+PIVOT"</span><span class="ot">=</span>{</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    duckdb<span class="sc">::</span><span class="fu">dbWriteTable</span>(con, <span class="st">"iris_long_i"</span>, N.df, <span class="at">overwrite=</span><span class="cn">TRUE</span>)</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    DBI<span class="sc">::</span><span class="fu">dbGetQuery</span>(con, <span class="st">'PIVOT iris_long_i USING mean(value) AS "." GROUP BY Species,part,dim'</span>)</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"polars</span><span class="sc">\n</span><span class="st">copy+pivot"</span><span class="ot">=</span>{</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>    polars_pivot <span class="ot">&lt;-</span> polars<span class="sc">::</span><span class="fu">as_polars_df</span>(</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>      N.df</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">$</span><span class="fu">pivot</span>(<span class="co"># wide reshape 2</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">on=</span><span class="st">"dummy"</span>, <span class="co"># have to create dummy var for on.</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">index=</span><span class="fu">c</span>(<span class="st">"Species"</span>,<span class="st">"part"</span>,<span class="st">"dim"</span>),</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">values=</span><span class="st">"value"</span>,</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">aggregate_function=</span><span class="st">"mean"</span>)</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>(polars_pivot)</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data.table</span><span class="sc">\n</span><span class="st">set+dcast"</span><span class="ot">=</span><span class="fu">setDF</span>(<span class="fu">dcast</span>(<span class="fu">setDT</span>(N.df), Species <span class="sc">+</span> part <span class="sc">+</span> dim <span class="sc">~</span> ., mean)))</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>pivot.copy.refs <span class="ot">&lt;-</span> atime<span class="sc">::</span><span class="fu">references_best</span>(pivot.copy.res)</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>pivot.copy.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(pivot.copy.refs)</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pivot.copy.pred)<span class="sc">+</span><span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="fl">1e1</span>,<span class="fl">1e7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in ggplot2::scale_x_log10("N", breaks = meas[, 10^seq(ceiling(min(log10(N))), : log-10
transformation introduced infinite values.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/atime-pivot-copy-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The result above shows that <code>data.table</code> is quite a bit faster than the others (5x or more).</p>
</section>
<section id="summary-of-long-to-wide-reshaping" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-long-to-wide-reshaping">Summary of long-to-wide reshaping</h2>
<p>In this section, we showed that <code>data.table</code> provides an efficient and feature-rich implementation of long-to-wide data reshaping. * The formula interface allows specifying a dot (<code>.</code>) which is a convenient way to specify output of only one row/column. In contrast, <code>polars</code> requires creating a dummy variable to do that. * The <code>fun.aggregate</code> argument may be a list of functions, each of which will be used on each of the <code>value.var</code> (a convenient way of specifying all combinations). In contrast, <code>duckdb</code> requires specifying each combination separately (more tedious/error-prone), and <code>polars</code> only supports one aggregation function (not a list).</p>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th>how to specify</th>
<th><code>data.table</code></th>
<th><code>polars</code></th>
<th><code>duckdb</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>function</td>
<td><code>dcast</code></td>
<td><code>pivot</code></td>
<td><code>PIVOT</code></td>
</tr>
<tr class="even">
<td>rows</td>
<td>LHS of formula</td>
<td><code>index</code></td>
<td><code>GROUP BY</code></td>
</tr>
<tr class="odd">
<td>columns</td>
<td>RHS of formula</td>
<td><code>on</code></td>
<td><code>ON</code></td>
</tr>
<tr class="even">
<td>no columns</td>
<td>dot <code>.</code></td>
<td>dummy variable</td>
<td>omit <code>ON</code></td>
</tr>
<tr class="odd">
<td>values</td>
<td><code>value.var</code></td>
<td><code>values</code></td>
<td><code>USING</code></td>
</tr>
<tr class="even">
<td>aggregation</td>
<td><code>aggregate.fun</code></td>
<td><code>aggregate_function</code></td>
<td><code>USING</code></td>
</tr>
<tr class="odd">
<td>multiple agg.</td>
<td>all combinations</td>
<td>one function</td>
<td>specified combinations</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>We have compared the reshaping functions in <code>data.table</code> to <code>duckdb</code> and <code>polars</code>. Although all three provide similar functionality for basic operations, we observed that <code>data.table</code> has several advantages for advanced/complex/efficient operations (reshaping columns which match a regex/separator, reshaping into multiple columns, avoiding copies, multiple aggregation). We also observed that the speed of <code>data.table</code> functions is comparable, if not faster, than the other packages.</p>
<section id="attribution" class="level2">
<h2 class="anchored" data-anchor-id="attribution">Attribution</h2>
<p>Parts of this blog post were copied from <a href="https://tdhock.github.io/blog/2024/collapse-reshape/">my more extensive comparison blog</a>.</p>
</section>
<section id="session-info" class="level2">
<h2 class="anchored" data-anchor-id="session-info">Session info</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.2 (2024-10-31)
Platform: aarch64-apple-darwin20
Running under: macOS Sequoia 15.1.1

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Los_Angeles
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] ggplot2_3.5.1     data.table_1.16.2

loaded via a namespace (and not attached):
 [1] gtable_0.3.6           jsonlite_1.8.9         dplyr_1.1.4            compiler_4.4.2        
 [5] tidyselect_1.2.1       directlabels_2024.1.21 scales_1.3.0           yaml_2.3.10           
 [9] fastmap_1.2.0          lattice_0.22-6         R6_2.5.1               labeling_0.4.3        
[13] generics_0.1.3         knitr_1.49             htmlwidgets_1.6.4      tibble_3.2.1          
[17] polars_0.21.0          munsell_0.5.1          atime_2024.11.29       DBI_1.2.3             
[21] pillar_1.9.0           rlang_1.1.4            utf8_1.2.4             xfun_0.49             
[25] quadprog_1.5-8         cli_3.6.3              withr_3.0.2            magrittr_2.0.3        
[29] digest_0.6.37          grid_4.4.2             rstudioapi_0.17.1      nc_2024.9.20          
[33] lifecycle_1.0.4        vctrs_0.6.5            bench_1.1.3            evaluate_1.0.1        
[37] glue_1.8.0             farver_2.1.2           duckdb_1.1.3           codetools_0.2-20      
[41] profmem_0.6.0          fansi_1.0.6            colorspace_2.1-1       rmarkdown_2.29        
[45] tools_4.4.2            pkgconfig_2.0.3        htmltools_0.5.8.1     </code></pre>
</div>
</div>



</section>
</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">
<div class="quarto-post image-right" data-index="0" data-categories="YW5ub3VuY2VtZW50cyUyQ2dyYW50" data-listing-date-sort="1752130800000" data-listing-file-modified-sort="1752187584919" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="3" data-listing-word-count-sort="506">
<div class="thumbnail">
<p><a href="../../posts/2025-07-10-numfocus-community_team/index.html" class="no-external"></a></p><a href="../../posts/2025-07-10-numfocus-community_team/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2025-07-10-numfocus-community_team/NumFocus_LRG.png" class="thumbnail-image"></p>
</a><p><a href="../../posts/2025-07-10-numfocus-community_team/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2025-07-10-numfocus-community_team/index.html" class="no-external">data.table is a NumFOCUS project!</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2025-07-10-numfocus-community_team/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('YW5ub3VuY2VtZW50cw=='); return false;">
announcements
</div>
<div class="listing-category" onclick="window.quartoListingCategory('Z3JhbnQ='); return false;">
grant
</div>
</div>
<div class="listing-description">
<a href="../../posts/2025-07-10-numfocus-community_team/index.html" class="no-external">We are SO excited to announce some massive news for the <code>data.table</code> community: <code>data.table</code> is now a NumFOCUS Sponsored Project!!!</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2025-07-10-numfocus-community_team/index.html" class="no-external">
<div class="listing-date">
Jul 10, 2025
</div>
<div class="listing-author">
Community Team
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="1" data-categories="Z3Vlc3QlMjBwb3N0JTJDdHV0b3JpYWxz" data-listing-date-sort="1751785200000" data-listing-file-modified-sort="1752187730979" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="11" data-listing-word-count-sort="2068">
<div class="thumbnail">
<p><a href="../../posts/2025-07-06-common_operations_datatable_and_dplyr-albert_rapp/index.html" class="no-external"></a></p><a href="../../posts/2025-07-06-common_operations_datatable_and_dplyr-albert_rapp/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2025-07-06-common_operations_datatable_and_dplyr-albert_rapp/image.png" class="thumbnail-image"></p>
</a><p><a href="../../posts/2025-07-06-common_operations_datatable_and_dplyr-albert_rapp/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2025-07-06-common_operations_datatable_and_dplyr-albert_rapp/index.html" class="no-external"><code>data.table</code> vs <code>dplyr</code>: A Side-by-Side Comparison</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2025-07-06-common_operations_datatable_and_dplyr-albert_rapp/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('Z3Vlc3QlMjBwb3N0'); return false;">
guest post
</div>
<div class="listing-category" onclick="window.quartoListingCategory('dHV0b3JpYWxz'); return false;">
tutorials
</div>
</div>
<div class="listing-description">
<a href="../../posts/2025-07-06-common_operations_datatable_and_dplyr-albert_rapp/index.html" class="no-external">[Note: This blog post originally appeared on albert-rapp.de and has been shared here to serve both the <code>{data.table}</code> and <code>{dplyr}</code> communities.]</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2025-07-06-common_operations_datatable_and_dplyr-albert_rapp/index.html" class="no-external">
<div class="listing-date">
Jul 6, 2025
</div>
<div class="listing-author">
Albert Rapp
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="2" data-categories="ZGV2ZWxvcGVyJTJDZ3Vlc3QlMjBwb3N0JTJDcGVyZm9ybWFuY2U=" data-listing-date-sort="1736755200000" data-listing-file-modified-sort="1752182335093" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="39" data-listing-word-count-sort="7775">
<div class="thumbnail">
<p><a href="../../posts/2025-01-13-non-api-use/index.html" class="no-external"></a></p><a href="../../posts/2025-01-13-non-api-use/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2025-01-13-non-api-use/image.jpg" class="thumbnail-image"></p>
</a><p><a href="../../posts/2025-01-13-non-api-use/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2025-01-13-non-api-use/index.html" class="no-external">Use of non-API entry points in <code>data.table</code></a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2025-01-13-non-api-use/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('ZGV2ZWxvcGVy'); return false;">
developer
</div>
<div class="listing-category" onclick="window.quartoListingCategory('Z3Vlc3QlMjBwb3N0'); return false;">
guest post
</div>
<div class="listing-category" onclick="window.quartoListingCategory('cGVyZm9ybWFuY2U='); return false;">
performance
</div>
</div>
<div class="listing-description">
<a href="../../posts/2025-01-13-non-api-use/index.html" class="no-external">In the late 1970’s, people at Bell Laboratories designed the S programming language in order to facilitate interactive exploratory data analysis <span class="citation" data-cites="Chambers2016">(Chambers 2016)</span>. Instead of…<span class="citation" data-cites="Becker1985"></span></a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2025-01-13-non-api-use/index.html" class="no-external">
<div class="listing-date">
Jan 13, 2025
</div>
<div class="listing-author">
Ivan Krylov
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="3" data-categories="dHV0b3JpYWxzJTJDY29tbXVuaXR5" data-listing-date-sort="1733558400000" data-listing-file-modified-sort="1733699642000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="2" data-listing-word-count-sort="326">
<div class="thumbnail">
<p><a href="../../posts/2024-12-07-advent_of_code-kelly_bodwin/index.html" class="no-external"></a></p><a href="../../posts/2024-12-07-advent_of_code-kelly_bodwin/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-12-07-advent_of_code-kelly_bodwin/aoc2.png" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-12-07-advent_of_code-kelly_bodwin/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-12-07-advent_of_code-kelly_bodwin/index.html" class="no-external">Advent of Code with <code>data.table</code>: Week One</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-12-07-advent_of_code-kelly_bodwin/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('dHV0b3JpYWxz'); return false;">
tutorials
</div>
<div class="listing-category" onclick="window.quartoListingCategory('Y29tbXVuaXR5'); return false;">
community
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-12-07-advent_of_code-kelly_bodwin/index.html" class="no-external">Happy December, R friends!</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-12-07-advent_of_code-kelly_bodwin/index.html" class="no-external">
<div class="listing-date">
Dec 7, 2024
</div>
<div class="listing-author">
Kelly Bodwin
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="4" data-categories="ZGV2ZWxvcGVyJTJDZ2l0aHViJTIwYWN0aW9uJTJDcGVyZm9ybWFuY2UlMjB0ZXN0aW5n" data-listing-date-sort="1731312000000" data-listing-file-modified-sort="1752182078716" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="11" data-listing-word-count-sort="2097">
<div class="thumbnail">
<p><a href="../../posts/2024-11-11-performance-testing-gha-anirban_chetia/index.html" class="no-external"></a></p><a href="../../posts/2024-11-11-performance-testing-gha-anirban_chetia/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-11-11-performance-testing-gha-anirban_chetia" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-11-11-performance-testing-gha-anirban_chetia/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-11-11-performance-testing-gha-anirban_chetia/index.html" class="no-external">Continuous performance testing using GitHub Actions</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-11-11-performance-testing-gha-anirban_chetia/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('ZGV2ZWxvcGVy'); return false;">
developer
</div>
<div class="listing-category" onclick="window.quartoListingCategory('Z2l0aHViJTIwYWN0aW9u'); return false;">
github action
</div>
<div class="listing-category" onclick="window.quartoListingCategory('cGVyZm9ybWFuY2UlMjB0ZXN0aW5n'); return false;">
performance testing
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-11-11-performance-testing-gha-anirban_chetia/index.html" class="no-external">In an effort to address the need for continuous performance benchmarking in <code>data.table</code>, I created a GitHub Action<sup>1</sup> to facilitate testing the time/memory-based performance of…</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-11-11-performance-testing-gha-anirban_chetia/index.html" class="no-external">
<div class="listing-date">
Nov 11, 2024
</div>
<div class="listing-author">
Anirban Chetia
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="5" data-categories="cGVyZm9ybWFuY2UlMkN0ZXN0aW5nJTJDZGV2ZWxvcGVy" data-listing-date-sort="1728543600000" data-listing-file-modified-sort="1729222897000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="12" data-listing-word-count-sort="2217">
<div class="thumbnail">
<p><a href="../../posts/2024-10-10-Performance-Doris_Amoakohene/index.html" class="no-external"></a></p><a href="../../posts/2024-10-10-Performance-Doris_Amoakohene/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-10-10-Performance-Doris_Amoakohene/atime.png" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-10-10-Performance-Doris_Amoakohene/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-10-10-Performance-Doris_Amoakohene/index.html" class="no-external">Visualizing performance regression of <code>data.table</code> with <code>atime</code></a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-10-10-Performance-Doris_Amoakohene/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('cGVyZm9ybWFuY2U='); return false;">
performance
</div>
<div class="listing-category" onclick="window.quartoListingCategory('dGVzdGluZw=='); return false;">
testing
</div>
<div class="listing-category" onclick="window.quartoListingCategory('ZGV2ZWxvcGVy'); return false;">
developer
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-10-10-Performance-Doris_Amoakohene/index.html" class="no-external">Since August 2023, I have been working on performance testing, which could be useful for expanding the open-source ecosystem around <code>data.table</code> package in R. This could…<code></code></a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-10-10-Performance-Doris_Amoakohene/index.html" class="no-external">
<div class="listing-date">
Oct 10, 2024
</div>
<div class="listing-author">
Doris Afriyie Amoakohene
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="6" data-categories="c2VhbCUyMG9mJTIwYXBwcm92YWwlMkNhcHBsaWNhdGlvbiUyMHBhY2thZ2U=" data-listing-date-sort="1727766000000" data-listing-file-modified-sort="1729222312000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="2" data-listing-word-count-sort="381">
<div class="thumbnail">
<p><a href="../../posts/2024-10-01-seal_of_approval-mlr3/index.html" class="no-external"></a></p><a href="../../posts/2024-10-01-seal_of_approval-mlr3/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-10-01-seal_of_approval-mlr3/hex_approved.png" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-10-01-seal_of_approval-mlr3/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-10-01-seal_of_approval-mlr3/index.html" class="no-external">Seal of Approval: mlr3</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-10-01-seal_of_approval-mlr3/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('c2VhbCUyMG9mJTIwYXBwcm92YWw='); return false;">
seal of approval
</div>
<div class="listing-category" onclick="window.quartoListingCategory('YXBwbGljYXRpb24lMjBwYWNrYWdl'); return false;">
application package
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-10-01-seal_of_approval-mlr3/index.html" class="no-external"><em>Author(s):</em> Michel Lang, Bernd Bischl, Jakob Richter, Patrick Schratz, Martin Binder, Florian Pfisterer, Raphael Sonabend, Marc Becker, Sebastian Fischer</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-10-01-seal_of_approval-mlr3/index.html" class="no-external">
<div class="listing-date">
Oct 1, 2024
</div>
<div class="listing-author">
Maximilian Mücke
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="7" data-categories="c2VhbCUyMG9mJTIwYXBwcm92YWwlMkNwYXJ0bmVyJTIwcGFja2FnZQ==" data-listing-date-sort="1726902000000" data-listing-file-modified-sort="1729222824000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="5" data-listing-word-count-sort="981">
<div class="thumbnail">
<p><a href="../../posts/2024-09-21-seal_of_approval-collapse/index.html" class="no-external"></a></p><a href="../../posts/2024-09-21-seal_of_approval-collapse/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-09-21-seal_of_approval-collapse/hex_approved.png" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-09-21-seal_of_approval-collapse/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-09-21-seal_of_approval-collapse/index.html" class="no-external">Seal of Approval: collapse</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-09-21-seal_of_approval-collapse/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('c2VhbCUyMG9mJTIwYXBwcm92YWw='); return false;">
seal of approval
</div>
<div class="listing-category" onclick="window.quartoListingCategory('cGFydG5lciUyMHBhY2thZ2U='); return false;">
partner package
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-09-21-seal_of_approval-collapse/index.html" class="no-external"><em>Author(s):</em> Sebastian Krantz</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-09-21-seal_of_approval-collapse/index.html" class="no-external">
<div class="listing-date">
Sep 21, 2024
</div>
<div class="listing-author">
Sebastian Krantz
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="8" data-categories="YW5ub3VuY2VtZW50cyUyQ2dyYW50JTJDdHJhbnNsYXRpb24=" data-listing-date-sort="1724137200000" data-listing-file-modified-sort="1729223516000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="1" data-listing-word-count-sort="140">
<div class="thumbnail">
<p><a href="../../posts/2024-08-20-translation_projects-community_team/index.html" class="no-external"></a></p><a href="../../posts/2024-08-20-translation_projects-community_team/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-08-20-translation_projects-community_team/languages.jpeg" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-08-20-translation_projects-community_team/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-08-20-translation_projects-community_team/index.html" class="no-external">Newly awarded translation projects</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-08-20-translation_projects-community_team/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('YW5ub3VuY2VtZW50cw=='); return false;">
announcements
</div>
<div class="listing-category" onclick="window.quartoListingCategory('Z3JhbnQ='); return false;">
grant
</div>
<div class="listing-category" onclick="window.quartoListingCategory('dHJhbnNsYXRpb24='); return false;">
translation
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-08-20-translation_projects-community_team/index.html" class="no-external">We are pleased to fund a French translation project, led by Philippe Grosjean, who is also the leader of the base R French translation. Co-authors include Christian Wia…</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-08-20-translation_projects-community_team/index.html" class="no-external">
<div class="listing-date">
Aug 20, 2024
</div>
<div class="listing-author">
Toby Dylan Hocking
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="9" data-categories="c2VhbCUyMG9mJTIwYXBwcm92YWwlMkNicmlkZ2UlMjBwYWNrYWdl" data-listing-date-sort="1722495600000" data-listing-file-modified-sort="1723483115000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="2" data-listing-word-count-sort="253">
<div class="thumbnail">
<p><a href="../../posts/2024-08-01-seal_of_approval-dtplyr/index.html" class="no-external"></a></p><a href="../../posts/2024-08-01-seal_of_approval-dtplyr/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-08-01-seal_of_approval-dtplyr/hex_approved.png" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-08-01-seal_of_approval-dtplyr/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-08-01-seal_of_approval-dtplyr/index.html" class="no-external">Seal of Approval: dtplyr</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-08-01-seal_of_approval-dtplyr/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('c2VhbCUyMG9mJTIwYXBwcm92YWw='); return false;">
seal of approval
</div>
<div class="listing-category" onclick="window.quartoListingCategory('YnJpZGdlJTIwcGFja2FnZQ=='); return false;">
bridge package
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-08-01-seal_of_approval-dtplyr/index.html" class="no-external"><em>Author(s):</em> Hadley Wickham, Maximilian Girlich, Mark Fairbanks, Ryan Dickerson, Posit Software PBC</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-08-01-seal_of_approval-dtplyr/index.html" class="no-external">
<div class="listing-date">
Aug 1, 2024
</div>
<div class="listing-author">
Kelly Bodwin
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="10" data-categories="c2VhbCUyMG9mJTIwYXBwcm92YWwlMkNleHRlbnNpb24lMjBwYWNrYWdl" data-listing-date-sort="1722495600000" data-listing-file-modified-sort="1723507004000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="4" data-listing-word-count-sort="698">
<div class="thumbnail">
<p><a href="../../posts/2024-08-01-seal_of_approval-nc/index.html" class="no-external"></a></p><a href="../../posts/2024-08-01-seal_of_approval-nc/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-08-01-seal_of_approval-nc/hex_approved.png" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-08-01-seal_of_approval-nc/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-08-01-seal_of_approval-nc/index.html" class="no-external">Seal of Approval: nc</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-08-01-seal_of_approval-nc/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('c2VhbCUyMG9mJTIwYXBwcm92YWw='); return false;">
seal of approval
</div>
<div class="listing-category" onclick="window.quartoListingCategory('ZXh0ZW5zaW9uJTIwcGFja2FnZQ=='); return false;">
extension package
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-08-01-seal_of_approval-nc/index.html" class="no-external"><em>Maintainer:</em> Toby Dylan Hocking (toby.hocking@r-project.org)</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-08-01-seal_of_approval-nc/index.html" class="no-external">
<div class="listing-date">
Aug 1, 2024
</div>
<div class="listing-author">
Toby Dylan Hocking
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="11" data-categories="c2VhbCUyMG9mJTIwYXBwcm92YWwlMkNicmlkZ2UlMjBwYWNrYWdl" data-listing-date-sort="1722495600000" data-listing-file-modified-sort="1727154989000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="4" data-listing-word-count-sort="657">
<div class="thumbnail">
<p><a href="../../posts/2024-08-01-seal_of_approval-tidyfast/index.html" class="no-external"></a></p><a href="../../posts/2024-08-01-seal_of_approval-tidyfast/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-08-01-seal_of_approval-tidyfast/hex_approved.png" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-08-01-seal_of_approval-tidyfast/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-08-01-seal_of_approval-tidyfast/index.html" class="no-external">Seal of Approval: tidyfast</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-08-01-seal_of_approval-tidyfast/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('c2VhbCUyMG9mJTIwYXBwcm92YWw='); return false;">
seal of approval
</div>
<div class="listing-category" onclick="window.quartoListingCategory('YnJpZGdlJTIwcGFja2FnZQ=='); return false;">
bridge package
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-08-01-seal_of_approval-tidyfast/index.html" class="no-external"><em>Author(s):</em> Tyson S. Barrett, Mark Fairbanks, Ivan Leung, Indrajeet Patil</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-08-01-seal_of_approval-tidyfast/index.html" class="no-external">
<div class="listing-date">
Aug 1, 2024
</div>
<div class="listing-author">
Tyson S. Barrett
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="12" data-categories="YW5ub3VuY2VtZW50cyUyQ2dyYW50JTJDY29tbXVuaXR5JTJDc2VhbCUyMG9mJTIwYXBwcm92YWw=" data-listing-date-sort="1722409200000" data-listing-file-modified-sort="1727154989000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="2" data-listing-word-count-sort="215">
<div class="thumbnail">
<p><a href="../../posts/2024-07-31-seal_of_approval_announcement-community_team/index.html" class="no-external"></a></p><a href="../../posts/2024-07-31-seal_of_approval_announcement-community_team/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-07-31-seal_of_approval_announcement-community_team/seal_of_approval.png" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-07-31-seal_of_approval_announcement-community_team/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-07-31-seal_of_approval_announcement-community_team/index.html" class="no-external">Announcement: The ‘Seal of Approval’</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-07-31-seal_of_approval_announcement-community_team/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('YW5ub3VuY2VtZW50cw=='); return false;">
announcements
</div>
<div class="listing-category" onclick="window.quartoListingCategory('Z3JhbnQ='); return false;">
grant
</div>
<div class="listing-category" onclick="window.quartoListingCategory('Y29tbXVuaXR5'); return false;">
community
</div>
<div class="listing-category" onclick="window.quartoListingCategory('c2VhbCUyMG9mJTIwYXBwcm92YWw='); return false;">
seal of approval
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-07-31-seal_of_approval_announcement-community_team/index.html" class="no-external">The Community Team, alongside a group of regular <code>data.table</code> contributors, is very pleased to announce a new <strong>Seal of Approval</strong> program!</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-07-31-seal_of_approval_announcement-community_team/index.html" class="no-external">
<div class="listing-date">
Jul 31, 2024
</div>
<div class="listing-author">
Kelly Bodwin
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="13" data-categories="YW5ub3VuY2VtZW50cyUyQ2dyYW50JTJDYW1iYXNzYWRvcnMlMkN0cmF2ZWw=" data-listing-date-sort="1718175600000" data-listing-file-modified-sort="1729222001000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="2" data-listing-word-count-sort="311">
<div class="thumbnail">
<p><a href="../../posts/2024-06-09-ambassador_corrales-community_team/index.html" class="no-external"></a></p><a href="../../posts/2024-06-09-ambassador_corrales-community_team/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-06-09-ambassador_corrales-community_team/Paola_Corrales.jpg" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-06-09-ambassador_corrales-community_team/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-06-09-ambassador_corrales-community_team/index.html" class="no-external">Announcement: Paola Corrales, data.table Ambassador</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-06-09-ambassador_corrales-community_team/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('YW5ub3VuY2VtZW50cw=='); return false;">
announcements
</div>
<div class="listing-category" onclick="window.quartoListingCategory('Z3JhbnQ='); return false;">
grant
</div>
<div class="listing-category" onclick="window.quartoListingCategory('YW1iYXNzYWRvcnM='); return false;">
ambassadors
</div>
<div class="listing-category" onclick="window.quartoListingCategory('dHJhdmVs'); return false;">
travel
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-06-09-ambassador_corrales-community_team/index.html" class="no-external">Paola is a professor teaching Data Science at Guillermo Brown University in Argentina, a developer of R packages and teaching materials, and a leader of the LatinR…<code></code><code></code><code></code></a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-06-09-ambassador_corrales-community_team/index.html" class="no-external">
<div class="listing-date">
Jun 12, 2024
</div>
<div class="listing-author">
Community Team
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="14" data-categories="b3Bpbmlvbg==" data-listing-date-sort="1717484400000" data-listing-file-modified-sort="1736843179000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="8" data-listing-word-count-sort="1405">
<div class="thumbnail">
<p><a href="../../posts/2024-05-20-kelly_bodwin/index.html" class="no-external"></a></p><a href="../../posts/2024-05-20-kelly_bodwin/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-05-20-kelly_bodwin/paths.jpg" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-05-20-kelly_bodwin/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-05-20-kelly_bodwin/index.html" class="no-external">Two Roads Diverged</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-05-20-kelly_bodwin/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('b3Bpbmlvbg=='); return false;">
opinion
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-05-20-kelly_bodwin/index.html" class="no-external">Two roads diverged in a wood and I, I took the one less traveled by, and that has made all the difference.</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-05-20-kelly_bodwin/index.html" class="no-external">
<div class="listing-date">
Jun 4, 2024
</div>
<div class="listing-author">
Kelly Bodwin
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="15" data-categories="Z3JhbnQlMkN0ZXN0aW5nJTJDZGV2ZWxvcGVy" data-listing-date-sort="1710057600000" data-listing-file-modified-sort="1727154989000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="8" data-listing-word-count-sort="1527">
<div class="thumbnail">
<p><a href="../../posts/2024-03-10-testing_plan-toby_hocking/index.html" class="no-external"></a></p><a href="../../posts/2024-03-10-testing_plan-toby_hocking/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-03-10-testing_plan-toby_hocking/code_testing.png" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-03-10-testing_plan-toby_hocking/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-03-10-testing_plan-toby_hocking/index.html" class="no-external">Testing infrastructure for data.table</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-03-10-testing_plan-toby_hocking/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('Z3JhbnQ='); return false;">
grant
</div>
<div class="listing-category" onclick="window.quartoListingCategory('dGVzdGluZw=='); return false;">
testing
</div>
<div class="listing-category" onclick="window.quartoListingCategory('ZGV2ZWxvcGVy'); return false;">
developer
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-03-10-testing_plan-toby_hocking/index.html" class="no-external">One major element of the NSF POSE grant for <code>data.table</code> is to create more documentation and testing infrastructure, in order to help expand the <code>data.table</code> ecosystem. This…</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-03-10-testing_plan-toby_hocking/index.html" class="no-external">
<div class="listing-date">
Mar 10, 2024
</div>
<div class="listing-author">
Toby Hocking
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="16" data-categories="Y29tbXVuaXR5JTJDZ3JhbnQ=" data-listing-date-sort="1709712000000" data-listing-file-modified-sort="1727154989000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="17" data-listing-word-count-sort="3396">
<div class="thumbnail">
<p><a href="../../posts/2024-03-06-interviews-anirban_chetia/index.html" class="no-external"></a></p><a href="../../posts/2024-03-06-interviews-anirban_chetia/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-03-06-interviews-anirban_chetia/index.jpeg" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-03-06-interviews-anirban_chetia/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-03-06-interviews-anirban_chetia/index.html" class="no-external">Community interviews about data.table</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-03-06-interviews-anirban_chetia/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('Y29tbXVuaXR5'); return false;">
community
</div>
<div class="listing-category" onclick="window.quartoListingCategory('Z3JhbnQ='); return false;">
grant
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-03-06-interviews-anirban_chetia/index.html" class="no-external">One stipulation of NSF POSE funded projects like this one was to conduct several interviews under NSF’s I-CORPS program (Winter 2024 Cohort), to gather information as to how <code>…</code><strong></strong><code></code></a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-03-06-interviews-anirban_chetia/index.html" class="no-external">
<div class="listing-date">
Mar 6, 2024
</div>
<div class="listing-author">
Anirban Chetia
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="17" data-categories="Y29tbXVuaXR5JTJDZ3Vlc3QlMjBwb3N0JTJDZ292ZXJuYW5jZQ==" data-listing-date-sort="1708848000000" data-listing-file-modified-sort="1715120890000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="6" data-listing-word-count-sort="1190">
<div class="thumbnail">
<p><a href="../../posts/2024-02-25-survey_2023-aljaz_sluga/index.html" class="no-external"></a></p><a href="../../posts/2024-02-25-survey_2023-aljaz_sluga/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-02-25-survey_2023-aljaz_sluga/usage_frequency.png" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-02-25-survey_2023-aljaz_sluga/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-02-25-survey_2023-aljaz_sluga/index.html" class="no-external">Results of the 2023 survey</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-02-25-survey_2023-aljaz_sluga/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('Y29tbXVuaXR5'); return false;">
community
</div>
<div class="listing-category" onclick="window.quartoListingCategory('Z3Vlc3QlMjBwb3N0'); return false;">
guest post
</div>
<div class="listing-category" onclick="window.quartoListingCategory('Z292ZXJuYW5jZQ=='); return false;">
governance
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-02-25-survey_2023-aljaz_sluga/index.html" class="no-external">Thanks to everyone who helped create, shared, or filled out the first data.table survey! The survey was officially open between October 17 and December 1 and it received <strong>391</strong> …</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-02-25-survey_2023-aljaz_sluga/index.html" class="no-external">
<div class="listing-date">
Feb 25, 2024
</div>
<div class="listing-author">
Aljaž Sluga
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="18" data-categories="dGlwcyUyQ3R1dG9yaWFscyUyQ2RldmVsb3Blcg==" data-listing-date-sort="1708243200000" data-listing-file-modified-sort="1727154989000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="5" data-listing-word-count-sort="918">
<div class="thumbnail">
<p><a href="../../posts/2024-02-18-dt_particularities-toby_hocking/index.html" class="no-external"></a></p><a href="../../posts/2024-02-18-dt_particularities-toby_hocking/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-02-18-dt_particularities-toby_hocking/copy_on_modify.png" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-02-18-dt_particularities-toby_hocking/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-02-18-dt_particularities-toby_hocking/index.html" class="no-external">Column assignment and reference semantics in data.table</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-02-18-dt_particularities-toby_hocking/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('dGlwcw=='); return false;">
tips
</div>
<div class="listing-category" onclick="window.quartoListingCategory('dHV0b3JpYWxz'); return false;">
tutorials
</div>
<div class="listing-category" onclick="window.quartoListingCategory('ZGV2ZWxvcGVy'); return false;">
developer
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-02-18-dt_particularities-toby_hocking/index.html" class="no-external">The goal of this blog post is to explain some similarities and differences between the base R <code>data.frame</code> object type, and the <code>data.table</code> object type. We will focus on…</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-02-18-dt_particularities-toby_hocking/index.html" class="no-external">
<div class="listing-date">
Feb 18, 2024
</div>
<div class="listing-author">
Toby Hocking
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="19" data-categories="dGlwcyUyQ3R1dG9yaWFscyUyQ2RvY3VtZW50YXRpb24=" data-listing-date-sort="1707120000000" data-listing-file-modified-sort="1715120890000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="5" data-listing-word-count-sort="914">
<div class="thumbnail">
<p><a href="../../posts/2024-02-05-tips_tricks_1-tyson_barrett/index.html" class="no-external"></a></p><a href="../../posts/2024-02-05-tips_tricks_1-tyson_barrett/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-02-05-tips_tricks_1-tyson_barrett/brackets.png" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-02-05-tips_tricks_1-tyson_barrett/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-02-05-tips_tricks_1-tyson_barrett/index.html" class="no-external">The Benefits of <code>data.table</code> Syntax</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-02-05-tips_tricks_1-tyson_barrett/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('dGlwcw=='); return false;">
tips
</div>
<div class="listing-category" onclick="window.quartoListingCategory('dHV0b3JpYWxz'); return false;">
tutorials
</div>
<div class="listing-category" onclick="window.quartoListingCategory('ZG9jdW1lbnRhdGlvbg=='); return false;">
documentation
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-02-05-tips_tricks_1-tyson_barrett/index.html" class="no-external">Among the many reasons to use <code>data.table</code> in your code (which includes the more common answers of speed, memory efficiency, etc.) is the <strong>syntax</strong>. The syntax is</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-02-05-tips_tricks_1-tyson_barrett/index.html" class="no-external">
<div class="listing-date">
Feb 5, 2024
</div>
<div class="listing-author">
Tyson Barrett
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="20" data-categories="Z292ZXJuYW5jZSUyQ3JlbGVhc2Vz" data-listing-date-sort="1706601600000" data-listing-file-modified-sort="1715120890000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="4" data-listing-word-count-sort="696">
<div class="thumbnail">
<p><a href="../../posts/2024-01-30-new_governance_new_release-toby_hocking/index.html" class="no-external"></a></p><a href="../../posts/2024-01-30-new_governance_new_release-toby_hocking/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-01-30-new_governance_new_release-toby_hocking/New-Release.jpg" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-01-30-new_governance_new_release-toby_hocking/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-01-30-new_governance_new_release-toby_hocking/index.html" class="no-external">New governance, release with new features</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-01-30-new_governance_new_release-toby_hocking/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('Z292ZXJuYW5jZQ=='); return false;">
governance
</div>
<div class="listing-category" onclick="window.quartoListingCategory('cmVsZWFzZXM='); return false;">
releases
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-01-30-new_governance_new_release-toby_hocking/index.html" class="no-external">I am proud to report that today, the first major new <code>data.table</code> features in several years have been released to CRAN!</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-01-30-new_governance_new_release-toby_hocking/index.html" class="no-external">
<div class="listing-date">
Jan 30, 2024
</div>
<div class="listing-author">
Toby Dylan Hocking
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="21" data-categories="dGlwcyUyQ3R1dG9yaWFscyUyQ2RvY3VtZW50YXRpb24lMkNndWVzdCUyMHBvc3Q=" data-listing-date-sort="1706428800000" data-listing-file-modified-sort="1715120890000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="5" data-listing-word-count-sort="988">
<div class="thumbnail">
<p><a href="../../posts/2024-01-28-piping_data_tables-elio_campitelli/index.html" class="no-external"></a></p><a href="../../posts/2024-01-28-piping_data_tables-elio_campitelli/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-01-28-piping_data_tables-elio_campitelli/image.jpg" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-01-28-piping_data_tables-elio_campitelli/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-01-28-piping_data_tables-elio_campitelli/index.html" class="no-external">Piping data.tables</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-01-28-piping_data_tables-elio_campitelli/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('dGlwcw=='); return false;">
tips
</div>
<div class="listing-category" onclick="window.quartoListingCategory('dHV0b3JpYWxz'); return false;">
tutorials
</div>
<div class="listing-category" onclick="window.quartoListingCategory('ZG9jdW1lbnRhdGlvbg=='); return false;">
documentation
</div>
<div class="listing-category" onclick="window.quartoListingCategory('Z3Vlc3QlMjBwb3N0'); return false;">
guest post
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-01-28-piping_data_tables-elio_campitelli/index.html" class="no-external">Like a devoted plumber, modern R loves pipes. The magrittr pipe has a long history and it’s fair share of detractors, but with the implementation of the native pipe operator …</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-01-28-piping_data_tables-elio_campitelli/index.html" class="no-external">
<div class="listing-date">
Jan 28, 2024
</div>
<div class="listing-author">
Elio Campitelli
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="22" data-categories="YW5ub3VuY2VtZW50cyUyQ2dyYW50JTJDYW1iYXNzYWRvcnM=" data-listing-date-sort="1705219200000" data-listing-file-modified-sort="1723483462000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="2" data-listing-word-count-sort="292">
<div class="thumbnail">
<p><a href="../../posts/2024-01-14-ambassador_gorecki-community_team/index.html" class="no-external"></a></p><a href="../../posts/2024-01-14-ambassador_gorecki-community_team/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2024-01-14-ambassador_gorecki-community_team/jan.png" class="thumbnail-image"></p>
</a><p><a href="../../posts/2024-01-14-ambassador_gorecki-community_team/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2024-01-14-ambassador_gorecki-community_team/index.html" class="no-external">Announcement: Jan Gorecki, data.table Ambassador</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2024-01-14-ambassador_gorecki-community_team/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('YW5ub3VuY2VtZW50cw=='); return false;">
announcements
</div>
<div class="listing-category" onclick="window.quartoListingCategory('Z3JhbnQ='); return false;">
grant
</div>
<div class="listing-category" onclick="window.quartoListingCategory('YW1iYXNzYWRvcnM='); return false;">
ambassadors
</div>
</div>
<div class="listing-description">
<a href="../../posts/2024-01-14-ambassador_gorecki-community_team/index.html" class="no-external">Jan is a natural choice for an Ambassador, due to his many years of fantastic contribution to the <code>data.table</code> package. You can find his great work in open-source development…<code></code></a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2024-01-14-ambassador_gorecki-community_team/index.html" class="no-external">
<div class="listing-date">
Jan 14, 2024
</div>
<div class="listing-author">
Kelly Bodwin
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="23" data-categories="Y29uZmVyZW5jZXM=" data-listing-date-sort="1700380800000" data-listing-file-modified-sort="1715120890000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="3" data-listing-word-count-sort="581">
<div class="thumbnail">
<p><a href="../../posts/2023-11-19-LatinR_summary-toby_hocking/index.html" class="no-external"></a></p><a href="../../posts/2023-11-19-LatinR_summary-toby_hocking/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2023-11-19-LatinR_summary-toby_hocking/image.jpg" class="thumbnail-image"></p>
</a><p><a href="../../posts/2023-11-19-LatinR_summary-toby_hocking/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2023-11-19-LatinR_summary-toby_hocking/index.html" class="no-external">Summary of LatinR conference</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2023-11-19-LatinR_summary-toby_hocking/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('Y29uZmVyZW5jZXM='); return false;">
conferences
</div>
</div>
<div class="listing-description">
<a href="../../posts/2023-11-19-LatinR_summary-toby_hocking/index.html" class="no-external">Last month, I (Toby) went to the LatinR conference in Montevideo, Uruguay. I had two goals: to teach about <code>data.table</code> in a tutorial, and to find people to work on…</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2023-11-19-LatinR_summary-toby_hocking/index.html" class="no-external">
<div class="listing-date">
Nov 19, 2023
</div>
<div class="listing-author">
Toby Dylan Hocking
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="24" data-categories="YW5ub3VuY2VtZW50cyUyQ2dyYW50JTJDZnVuZGluZyUyMG9wcG9ydHVuaXR5" data-listing-date-sort="1698822000000" data-listing-file-modified-sort="1715120890000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="3" data-listing-word-count-sort="428">
<div class="thumbnail">
<p><a href="../../posts/2023-11-01-travel_grant_announcement-community_team/index.html" class="no-external"></a></p><a href="../../posts/2023-11-01-travel_grant_announcement-community_team/index.html" class="no-external">
<p><img loading="lazy" src="../../posts/2023-11-01-travel_grant_announcement-community_team/image.jpg" class="thumbnail-image"></p>
</a><p><a href="../../posts/2023-11-01-travel_grant_announcement-community_team/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2023-11-01-travel_grant_announcement-community_team/index.html" class="no-external">Announcement: The data.table Ambassadors Travel Grant</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2023-11-01-travel_grant_announcement-community_team/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('YW5ub3VuY2VtZW50cw=='); return false;">
announcements
</div>
<div class="listing-category" onclick="window.quartoListingCategory('Z3JhbnQ='); return false;">
grant
</div>
<div class="listing-category" onclick="window.quartoListingCategory('ZnVuZGluZyUyMG9wcG9ydHVuaXR5'); return false;">
funding opportunity
</div>
</div>
<div class="listing-description">
<a href="../../posts/2023-11-01-travel_grant_announcement-community_team/index.html" class="no-external">We on the community team are very excited to announce another major funding opportunity!</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2023-11-01-travel_grant_announcement-community_team/index.html" class="no-external">
<div class="listing-date">
Nov 1, 2023
</div>
<div class="listing-author">
Kelly Bodwin
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="25" data-categories="YW5ub3VuY2VtZW50cyUyQ2dyYW50JTJDZnVuZGluZyUyMG9wcG9ydHVuaXR5" data-listing-date-sort="1697526000000" data-listing-file-modified-sort="1715120890000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="4" data-listing-word-count-sort="664">
<div class="thumbnail">
<p><a href="../../posts/2023-10-17-translation_announcement-toby_hocking/index.html" class="no-external"></a></p><a href="../../posts/2023-10-17-translation_announcement-toby_hocking/index.html" class="no-external">
<p><img loading="lazy" data-src="../../posts/2023-10-17-translation_announcement-toby_hocking/translate.jpeg" class="thumbnail-image"></p>
</a><p><a href="../../posts/2023-10-17-translation_announcement-toby_hocking/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2023-10-17-translation_announcement-toby_hocking/index.html" class="no-external">Announcement: data.table translation projects</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2023-10-17-translation_announcement-toby_hocking/index.html" class="no-external"></a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('YW5ub3VuY2VtZW50cw=='); return false;">
announcements
</div>
<div class="listing-category" onclick="window.quartoListingCategory('Z3JhbnQ='); return false;">
grant
</div>
<div class="listing-category" onclick="window.quartoListingCategory('ZnVuZGluZyUyMG9wcG9ydHVuaXR5'); return false;">
funding opportunity
</div>
</div>
<div class="listing-description">
<a href="../../posts/2023-10-17-translation_announcement-toby_hocking/index.html" class="no-external">In 2023-2025, National Science Foundation (NSF) has provided funds to support the project “Expanding the data.table ecosystem for efficient big data manipulation in R.” One…<code></code></a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2023-10-17-translation_announcement-toby_hocking/index.html" class="no-external">
<div class="listing-date">
Oct 17, 2023
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="26" data-categories="YW5ub3VuY2VtZW50cyUyQ2dyYW50" data-listing-date-sort="1697353200000" data-listing-file-modified-sort="1727154989000" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="4" data-listing-word-count-sort="640">
<div class="thumbnail">
<p><a href="../../posts/2023-10-15-intro_to_grant-toby_hocking/index.html" class="no-external"></a></p><a href="../../posts/2023-10-15-intro_to_grant-toby_hocking/index.html" class="no-external">
<p><img loading="lazy" data-src="../../posts/2023-10-15-intro_to_grant-toby_hocking/sea_lions.jpg" class="thumbnail-image"></p>
</a><p><a href="../../posts/2023-10-15-intro_to_grant-toby_hocking/index.html" class="no-external"></a></p>
</div>
<div class="body">
<h3 class="no-anchor listing-title">
<a href="../../posts/2023-10-15-intro_to_grant-toby_hocking/index.html" class="no-external">Welcome to the data.table ecosystem project!</a>
</h3>
<div class="listing-subtitle">
<a href="../../posts/2023-10-15-intro_to_grant-toby_hocking/index.html" class="no-external">An NSF-POSE funded venture.</a>
</div>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('YW5ub3VuY2VtZW50cw=='); return false;">
announcements
</div>
<div class="listing-category" onclick="window.quartoListingCategory('Z3JhbnQ='); return false;">
grant
</div>
</div>
<div class="listing-description">
<a href="../../posts/2023-10-15-intro_to_grant-toby_hocking/index.html" class="no-external">Hi! My name is Toby Dylan Hocking, and I have been using R since 2003, which means 20 years, can you believe it?</a>
</div>
</div>
<div class="metadata">
<a href="../../posts/2023-10-15-intro_to_grant-toby_hocking/index.html" class="no-external">
<div class="listing-date">
Oct 15, 2023
</div>
<div class="listing-author">
Toby Hocking
</div>
</a>
</div>
</div>
</div>
<div class="listing-no-matching d-none">
No matching items
</div>
<nav id="listing-pagination" class="listing-pagination" aria-label="Page Navigation">
  <ul class="pagination"></ul>
</nav>
</div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/rdatatable-community\.github\.io\/The-Raft");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>